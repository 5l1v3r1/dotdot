{"version":3,"sources":["sections/Chat/Footer/TextIcon/index.module.scss","sections/Chat/Messages/Message/Heading/index.module.scss","sections/Chat/Messages/Message/Reply/index.module.scss","sections/Chat/index.module.scss","sections/Chat/Session/AdminBadge/index.module.scss","sections/Chat/Session/PasswordModal/index.module.scss","sections/Login/index.module.scss","sections/Chat/OnlineUsers/index.module.scss","sections/Chat/Messages/Message/ReplyButton/index.module.scss","sections/Chat/Footer/Reply/index.module.scss","sections/Chat/Footer/index.module.scss","components/OfflineCheck/index.module.scss","sections/Chat/Messages/Message/lib/index.module.scss","sections/Chat/Messages/Message/MessageContent/index.module.scss","sections/Chat/Footer/Submit/index.module.scss","sections/Chat/Messages/Message/index.module.scss","assets/sounds/newMessage.mp3","sections/Chat/Messages/Message/MessageContent/Embed/index.module.scss","sections/Chat/Footer/Field/index.module.scss","store/types.ts","constants.ts","sections/Admin/RealtimeChart/index.tsx","lib/secondsToHuman.ts","util/socketProvider.tsx","sections/Admin/Widget/index.tsx","sections/Admin/index.tsx","lib/color/psbc.ts","lib/color/makeColorReadable.ts","lib/color/getRgbLuminance.ts","lib/color/hex2rgb.ts","store/reducer.ts","store/state.tsx","components/LogoAnimation/index.tsx","components/Loader/index.tsx","components/Logo/index.tsx","sections/Chat/Session/UserBadge/index.tsx","sections/Chat/Session/AdminBadge/index.tsx","util/fetch.ts","sections/Chat/Session/PasswordModal/index.tsx","sections/Chat/Session/index.tsx","sections/Chat/OnlineUsers/User/index.tsx","sections/Chat/OnlineUsers/index.tsx","sections/Chat/Header/index.tsx","sections/Chat/Messages/Message/HelpMessage/index.tsx","sections/Chat/Messages/Message/lib/parseContent.tsx","sections/Chat/Messages/Message/MessageContent/Embed/index.tsx","sections/Chat/Messages/Message/MessageContent/index.tsx","sections/Chat/Messages/Message/PlayBackMessage/index.tsx","sections/Chat/Messages/Message/Heading/index.tsx","sections/Chat/Messages/Message/Reply/index.tsx","sections/Chat/Messages/Message/ReplyButton/index.tsx","sections/Chat/Messages/Message/index.tsx","sections/Chat/Messages/ScrollBox/index.tsx","sections/Chat/Messages/index.tsx","lib/dateDiff.ts","sections/Chat/Footer/Reply/index.tsx","sections/Chat/Footer/Field/index.tsx","sections/Chat/Footer/Submit/index.tsx","sections/Chat/Footer/TextIcon/index.tsx","sections/Chat/Footer/index.tsx","lib/messageParse.ts","sections/Chat/Footer/lib/timedDiff.ts","sections/Chat/index.tsx","sections/loading/index.tsx","util/AuthenticatedRoute.tsx","util/UnauthenticatedRoute.tsx","components/OfflineCheck/index.tsx","sections/Login/index.tsx","util/checkAuth.ts","router.tsx","components/Title/index.tsx","lib/icons.ts","index.tsx","sections/Chat/Header/index.module.scss","sections/Chat/Session/UserBadge/index.module.scss","sections/Chat/Messages/index.module.scss","sections/Admin/Widget/index.module.scss","components/LogoAnimation/index.module.scss"],"names":["module","exports","EVENTS","CONNECT","DISCONNECT","MESSAGE","COMMAND","HISTORY","ONLINE_USERS","STATS","TIMER","CONTROL","CHANGE_ROOM","API_URL","process","VALID_USERNAME","CAPTCHA_KEY","props","data","map","num","index","date","value","i","length","MAX_STATS_BARS","push","style","width","height","barSize","barCategoryGap","barGap","margin","top","bottom","left","right","allowDecimals","dataKey","tick","label","position","offset","fill","stroke","isAnimationActive","type","cursor","forHumans","seconds","levels","Math","floor","returntext","max","trim","SocketContext","createContext","socket","useGlobalState","state","dispatch","useState","setSocket","hasPassword","auth","user","useEffect","loggedIn","payload","newSocket","socketio","reconnection","timeout","setInterval","connected","emit","setTimeout","Object","values","forEach","event","on","error","provider","Provider","children","content","className","styles","title","icon","classNames","iconBg","history","dashboardWidget","tooltip","Tooltip","id","OverlayTrigger","delay","show","hide","overlay","useContext","totalTime","stats","timeActive","timeInactive","statsData","header","round","sessions","detail","onlineUsers","totalUsers","totalMessages","cpuUsage","freeMemory","uptime","roomData","rooms","Container","fluid","Row","Col","RealtimeChart","messages","users","onClick","room","activePayload","domain","stackId","row","key","Widget","pSBC","p","c0","r","g","b","P","f","t","h","c1","l","parseInt","m","a","window","pSBCr","d","n","x","split","slice","parseFloat","toString","undefined","getThemeOffset","colorRgb","lightMode","lum","v","pow","getRgbLuminance","makeColorReadable","color","hex","result","exec","hex2Rgb","isLightMode","matchMedia","matches","produce","draft","action","offline","checked","systemMessage","uuid","uuidv4","systemUser","timestamp","Date","attributes","private","contrastColor","incomingMessage","draftIsPastMessage","draftIndex","eachMessage","user_id","isEmpty","splice","timedContent","replyToId","messageReply","find","replyTo","lastMessage","message","shift","keys","chat","focused","name","isActive","initialState","draftTimer","Array","StateContext","React","console","warn","StateProvider","useReducer","reducer","infinite","animationIterationCount","animationDirection","logo","blob","svgFilter","xmlns","version","in","stdDeviation","mode","in2","transform","LogoAnimation","lettersColor","viewBox","fillRule","xlinkHref","opacity","mask","cx","cy","rx","ry","small","isLocked","badge","dot","lock","closed","href","marginLeft","csrfToken","axios","defaults","withCredentials","fetchResource","path","method","body","Error","url","options","xsrfHeaderName","headers","response","status","parseAxiosError","errors","parseErrorList","join","defaultError","isArray","parseErrors","useFetch","onHide","validated","setValidated","password","setPassword","repeatPassword","setRepeatPassword","Modal","Form","noValidate","onSubmit","preventDefault","stopPropagation","currentTarget","checkValidity","then","catch","reason","Header","closeButton","Title","Body","Group","controlId","Control","as","autoComplete","placeholder","autoFocus","required","minLength","onChange","Feedback","pattern","Footer","footer","Button","variant","isOpen","setModalOpen","tooltipText","AdminBadge","isAdmin","placement","UserBadge","PasswordModal","isCurrentUser","iconName","inactive","userColor","count","User","scrollingWhileFocused","pageYOffset","container","Logo","online","OnlineUsers","Session","Table","size","rel","target","USER_REGEX","RegExp","URL_REGEX","useImmer","loading","setState","replace","description","favicon","embed","author_name","author_url","images","oEmbed","provider_name","twitter_card","players","site","open_graph","sizes","video","aspect","maxWidth","SoundCloud","src","frameBorder","allowFullScreen","allowTransparency","allow","alt","author","image","isSystem","messageContent","urls","HelpMessage","match","includes","reactStringReplace","username","eachUser","mention","source","unwrapDisallowed","allowedTypes","parseContent","embeds","useMemo","Embed","PlayBackMessage","shownText","currentIndex","isAnimating","timer","this","timers","nextAnimationStep","prevProps","clearTimeout","nextIndex","animationStep","step","char","nextStepAvailable","updatedText","applyChangeToText","min","text","newText","tmp","PureComponent","Heading","isDraft","isPrivate","isOnline","isReply","userContrastColor","UserIcon","justIcon","spin","Username","TimeStamp","toLocaleTimeString","hour","minute","Reply","Bar","aria-hidden","bar","background","replyBox","messageStyles","scroll","Message","reply","button","MessageComponent","memo","messageBody","userData","isUserOnline","findIndex","isReplyAllowed","MessageContent","system","frame","actions","ReplyButton","smoothscroll","polyfill","ScrollBox","scrollDebounceTimer","scrollListenerSetup","stayAtBottom","onScrollDebounced","onScroll","shouldScroll","onScrollChanged","boxRef","threshold","current","scrollHeight","offsetHeight","customThreshold","isAtBottom","abs","scrollTop","scrollToBottom","behavior","setupListener","addEventListener","removeEventListener","override","onMessageClick","scrollAtBottom","unseenMessages","localState","setLocalState","chatAreaRef","useRef","useCallback","unseen","unseenContainer","messageScroll","ref","messagesContainer","dateDiff","t1","t2","getTime","onCancelReply","borderLeftColor","kind","inputRef","handleFocus","focus","field","command","inputArea","onFocus","onBlur","disabled","onHelp","textIcon","interactive","timedMessage","lastKeyStroke","to","askForHelp","sendMessage","FieldActions","TextIcon","Submit","e","Field","val","isCommand","isPm","currentValue","previousValue","diffs","diff","timedMessages","timeDiff","eachDiff","EQUAL","DELETE","INSERT","timedDiff","words","test","substr","getMessagePmTo","messageId","cancelReply","setHeaderPosition","scrollingChat","Messages","Loader","exact","component","String","verified","captchaRef","oncaptchaChange","token","captchaToken","resetCaptcha","theme","all","login","execute","singleLineForm","InputGroup","bsPrefix","singleLineFormPiece","Prepend","Text","at","maxLength","subtitle","log","sitekey","CAPTCHA_PROVIDER","sm","md","ksp","copy","github","checkAuth","OfflineCheck","UnauthenticatedRoute","Login","AuthenticatedRoute","Admin","Chat","lastSound","windowFocused","titleNotification","useSound","newMessageSound","interrupt","volume","play","onMessage","msg","Helmet","library","add","faLock","faLockOpen","faEyeSlash","faCircle","faDotCircle","farDotCircle","faCircleNotch","faCode","faCog","faArrowAltCircleDown","faMeh","farMeh","faAngry","faDizzy","faFlushed","faFrown","faFrownOpen","faGrimace","faGrin","faGrinAlt","faGrinBeam","faGrinBeamSweat","faGrinHearts","faGrinSquint","faGrinSquintTears","faGrinStars","faGrinTears","faGrinTongue","faGrinTongueSquint","faGrinTongueWink","faGrinWink","faKiss","faKissBeam","faKissWinkHeart","faLaugh","faLaughBeam","faLaughSquint","faLaughWink","faMehBlank","faMehRollingEyes","faSadCry","faSadTear","faSmile","faSmileBeam","faSmileWink","faSurprise","faTired","farAngry","farDizzy","farFlushed","farFrown","farFrownOpen","farGrimace","farGrin","farGrinAlt","farGrinBeam","farGrinBeamSweat","farGrinHearts","farGrinSquint","farGrinSquintTears","farGrinStars","farGrinTears","farGrinTongue","farGrinTongueSquint","farGrinTongueWink","farGrinWink","farKiss","farKissBeam","farKissWinkHeart","farLaugh","farLaughBeam","farLaughSquint","farLaughWink","farMehBlank","farMehRollingEyes","farSadCry","farSadTear","farSmile","farSmileBeam","farSmileWink","farSurprise","farTired","faShieldAlt","faQuestionCircle","faPaperPlane","faTimes","faReply","faExternalLinkAlt","faRobot","faGithub","app","basename","ReactDOM","render","document","getElementById"],"mappings":"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","file":"static/js/main.3f805b73.chunk.js","sourcesContent":["// extracted by mini-css-extract-plugin\nmodule.exports = {\"textIcon\":\"TextIcon_textIcon__2H6ej\",\"interactive\":\"TextIcon_interactive__j55M9\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"user\":\"Heading_user__uz1g1\",\"icon\":\"Heading_icon__14zc-\",\"timestamp\":\"Heading_timestamp__15UxH\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"replyBox\":\"Reply_replyBox__3mE6c\",\"scroll\":\"Reply_scroll__7Q4qn\",\"bar\":\"Reply_bar__2Gy8W\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"chat\":\"Chat_chat__LEZtX\",\"scrollingChat\":\"Chat_scrollingChat__165RB\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"badge\":\"AdminBadge_badge__1HTPx\",\"icon\":\"AdminBadge_icon__H_GPA\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"footer\":\"PasswordModal_footer__32ASO\",\"left\":\"PasswordModal_left__1uFYg\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"all\":\"Login_all__3_Oov\",\"login\":\"Login_login__38Hzs\",\"at\":\"Login_at__UtX6T\",\"title\":\"Login_title__2HYHS\",\"subtitle\":\"Login_subtitle__2TNDk\",\"singleLineForm\":\"Login_singleLineForm__31MrB\",\"singleLineFormPiece\":\"Login_singleLineFormPiece__39YU5\",\"logo\":\"Login_logo__BAZaG\",\"description\":\"Login_description__2hJcw\",\"ksp\":\"Login_ksp__3AFPV\",\"copy\":\"Login_copy__1xxvL\",\"github\":\"Login_github__1tuKP\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"onlineUsers\":\"OnlineUsers_onlineUsers__2Umxk\",\"count\":\"OnlineUsers_count__1iz1Q\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"button\":\"ReplyButton_button__2PpgC\",\"text\":\"ReplyButton_text__1QpOS\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"reply\":\"Reply_reply__F5QhM\",\"actions\":\"Reply_actions__xvZzN\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"footer\":\"Footer_footer__pTkkR\",\"container\":\"Footer_container__323Ar\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"offline\":\"OfflineCheck_offline__2vKbm\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"mention\":\"lib_mention__1QimP\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"messageContent\":\"MessageContent_messageContent__2lJQW\",\"mention\":\"MessageContent_mention__1rALG\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"button\":\"Submit_button__VLsx-\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"message\":\"Message_message__2v30T\",\"reply\":\"Message_reply__jMrB5\",\"frame\":\"Message_frame__3Tkew\",\"actions\":\"Message_actions__1uRE4\",\"system\":\"Message_system__2g6ZE\",\"offline\":\"Message_offline__32gHu\",\"icon\":\"Message_icon__ATXFm\",\"user\":\"Message_user__3HofW\",\"inactive\":\"Message_inactive__2OBrK\",\"draft\":\"Message_draft__1zB7h\",\"body\":\"Message_body__32TEj\",\"header\":\"Message_header__3wUCX\",\"private\":\"Message_private__ORZ48\"};","module.exports = __webpack_public_path__ + \"static/media/newMessage.482e2f99.mp3\";","// extracted by mini-css-extract-plugin\nmodule.exports = {\"embed\":\"Embed_embed__3wuAi\",\"title\":\"Embed_title__2Mpxf\",\"icon\":\"Embed_icon__1MOM5\",\"description\":\"Embed_description__12iOR\",\"author\":\"Embed_author__3e6ma\",\"images\":\"Embed_images__HWNzQ\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"field\":\"Field_field__3cbYw\",\"focused\":\"Field_focused__3YLuR\",\"private\":\"Field_private__3D8g3\",\"command\":\"Field_command__3ZUJA\",\"inputArea\":\"Field_inputArea__3Xbcc\",\"actions\":\"Field_actions__KHHdb\"};","import { IconName } from \"@fortawesome/fontawesome-svg-core\"\n\nimport { TimedChange } from \"sections/Chat/Footer/lib/timedDiff\"\n\nexport type User = {\n  user_id: string\n  name: string\n  color: string\n  contrastColor?: string\n  icon: IconName | null\n  isActive: boolean\n  isAdmin?: boolean\n  hasPassword: boolean\n}\n\nexport type MessageAttributes = {\n  draft: boolean\n  private: boolean\n  to?: string | null\n  replyToId?: string | null\n  replyTo?: Message | null\n}\n\nexport type Message = {\n  uuid: string\n  user: User\n  timestamp: Date\n  content: string[]\n  timedContent?: TimedChange[]\n  attributes: MessageAttributes\n}\n\nexport type IncomingMessage = {\n  uuid: string\n  user: User\n  timestamp: Date\n  content: string\n  timedContent?: TimedChange[]\n  attributes: MessageAttributes\n}\n\nexport type OutgoingMessage = {\n  content: string\n  timedContent?: TimedChange[]\n  attributes: MessageAttributes\n}\n\nexport type RoomStats = {\n  id: string\n  active: number\n  inactive: number\n}\n\nexport type AppState = {\n  auth: {\n    checked: boolean\n    loggedIn: boolean\n    user: User | null\n  }\n  socket: {\n    connected: boolean\n  }\n  draftTimer: number\n  onlineUsers: User[]\n  messages: Message[]\n  stats: {\n    messages: number[]\n    users: number[]\n    rooms: RoomStats[]\n    onlineUsers: number\n    totalMessages: number\n    totalUsers: number\n    cpuUsage: number\n    freeMemory: number\n    uptime: number\n    timeActive: number\n    timeInactive: number\n    sessions: number\n  }\n  offline: boolean\n  error: string | null\n  chat: {\n    focused: boolean\n  }\n\n  [key: string]: any\n}\n\nexport type Action = {\n  type: string\n  payload?: any\n}\n\nexport type AppContext = {\n  state: AppState\n  dispatch: React.Dispatch<Action>\n}\n\nexport type AuthData = {\n  user: User\n  token: string\n}\n\nexport const EVENTS = {\n  CONNECT: 'connect',\n  DISCONNECT: 'disconnect',\n  MESSAGE: 'message',\n  COMMAND: 'command',\n  HISTORY: 'history',\n  ONLINE_USERS: 'users',\n  STATS: 'stats',\n  TIMER: 'timer',\n  CONTROL: 'control',\n  CHANGE_ROOM: 'change_room',\n}\n","export const API_URL = process.env.REACT_APP_API_URL || 'https://api.dotdot.im'\nexport const VALID_USERNAME = /^[A-Za-z0-9]+(?:[ _][A-Za-z0-9]+)*_?$/i\nexport const CAPTCHA_PROVIDER = process.env.REACT_APP_CAPTCHA_PROVIDER || 'recaptcha'\nexport const CAPTCHA_KEY = process.env.REACT_APP_CAPTCHA_KEY || ''\nexport const MAX_MESSAGE_HISTORY = 100\n","import React from 'react'\nimport { AreaChart, XAxis, YAxis, Area, Tooltip, ResponsiveContainer, Label } from 'recharts'\nimport { MAX_STATS_BARS } from '..';\n\ntype Props = {\n  data: number[],\n  height?: number,\n  label: string,\n};\n\nexport default (props: Props) => {\n  const data = props.data.map((num, index) => ({\n    date: index,\n    value: num,\n  }))\n\n  for (let i = data.length; i < MAX_STATS_BARS; i++) {\n    data.push({\n      date: i,\n      value: 0,\n    })\n  }\n\n  return (\n    <div style={ { width: '100%', height: `${ props.height || 250 }px` } }>\n      <ResponsiveContainer>\n        <AreaChart data={data} barSize={ 5 } barCategoryGap={ 2 } barGap={ 2 } margin={{ top: 50, bottom: 20, left: 0, right: 0}}>\n          <YAxis allowDecimals={ false } />\n          <XAxis dataKey=\"date\" tick={false}>\n            <Label value={ props.label } position=\"bottom\" offset={ -15 } fill='#ccc' />\n          </XAxis>\n          <Area dataKey=\"value\" fill=\"#f75f00\" stroke=\"#f75f00\" isAnimationActive={ false } type='linear' />\n          <Tooltip cursor={ { fill: 'rgba(255, 255, 255, 0.1)' } }/>\n        </AreaChart>\n      </ResponsiveContainer>\n    </div>\n  )\n}","export function forHumans ( seconds: number ) {\n  const levels: [number, string][] = [\n      [Math.floor(seconds / 31536000), 'y'],\n      [Math.floor((seconds % 31536000) / 86400), 'd'],\n      [Math.floor(((seconds % 31536000) % 86400) / 3600), 'h'],\n      [Math.floor((((seconds % 31536000) % 86400) % 3600) / 60), 'm'],\n      [(((seconds % 31536000) % 86400) % 3600) % 60, 's'],\n  ];\n  let returntext = '';\n\n  for (let i = 0, max = levels.length; i < max; i++) {\n      if ( levels[i][0] === 0 ) continue;\n      returntext += ' ' + levels[i][0] + levels[i][1];\n  };\n  return returntext.trim();\n}","import React, { createContext, useEffect, useState } from 'react'\nimport socketio from 'socket.io-client'\n\nimport { useGlobalState } from 'store/state'\nimport { API_URL } from '../constants'\nimport { Message, EVENTS } from 'store/types'\n\nconst USAGE_TIMER_INTERAL = 30 * 1000\n\ntype SocketContextType = {\n  socket: SocketIOClient.Socket | null\n}\n\nexport const SocketContext = createContext<SocketContextType>({\n  socket: null,\n})\n\ntype Props = {\n  children: any\n}\n\nexport default (props: Props) => {\n  const { state, dispatch } = useGlobalState()\n  const [socket, setSocket] = useState<SocketIOClient.Socket | null>(null)\n\n  const hasPassword = state.auth.user?.hasPassword;\n\n  useEffect(() => {\n    if (!state.auth.loggedIn) {\n      return\n    }\n\n    // socket already set up\n    if (socket) {\n      return;\n    }\n\n    // clear any errors\n    dispatch({\n      type: 'error',\n      payload: null,\n    })\n\n    // initialize the socket\n    const newSocket = socketio(API_URL, {\n      reconnection: true,\n      timeout: 2000,\n    })\n\n    setInterval(() => {\n      if (newSocket.connected) {\n        newSocket.emit('timer')\n      }\n    }, USAGE_TIMER_INTERAL)\n\n    // remind to set a password\n    if (!hasPassword) {\n      setTimeout(() => {\n        dispatch({\n          type: 'system_message',\n          payload: 'Remember: If you want to keep this username, you must set a password! You can set it by clicking on the lock icon on the top right of the screen.'\n        })\n      }, 60 * 1000);\n    }\n\n    Object.values(EVENTS).forEach(event => {\n      newSocket.on(event, (payload: any) => {\n        dispatch({\n          type: `socket_${event}`,\n          payload: payload,\n        })\n      })\n    })\n\n    newSocket.on('stats', (payload: Message[]) => {\n      dispatch({\n        type: 'stats',\n        payload,\n      })\n    })\n\n    newSocket.on('connect_error', () => {\n      dispatch({\n        type: 'offline',\n        payload: null,\n      })\n    })\n\n    newSocket.on('connect_timeout', () => {\n      dispatch({\n        type: 'offline',\n        payload: null,\n      })\n    })\n\n    newSocket.on('error', (error: string) => {\n      dispatch({\n        type: `socket_${EVENTS.DISCONNECT}`,\n      })\n\n      if (error) {\n        dispatch({\n          type: 'error',\n          payload: error,\n        })\n        dispatch({\n          type: 'login',\n          payload: null,\n        })\n      } else {\n        dispatch({\n          type: 'offline',\n          payload: null,\n        })\n      }\n    })\n\n    setSocket(newSocket)\n  }, [dispatch, socket, state.auth.loggedIn, hasPassword])\n\n  let provider = {\n    socket,\n  }\n\n  return (\n    <SocketContext.Provider value={provider}>\n      {props.children}\n    </SocketContext.Provider>\n  )\n}\n","import React from 'react'\nimport { IconProp } from '@fortawesome/fontawesome-svg-core';\nimport classNames from 'classnames';\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\nimport { Tooltip, OverlayTrigger } from 'react-bootstrap';\n\nimport styles from './index.module.scss'\n\ntype Props = {\n  title: string;\n  content: string | number | null;\n  icon?: IconProp;\n  iconBg?: \"blue\" | \"orange\" | \"green\";\n  history?: string | number | null;\n  tooltip?: string;\n};\n\nexport default (props: Props) => {\n  let content = (\n    <>\n      <div className={ styles.title }>{props.title}</div>\n      <span className={ styles.content }>{props.content}</span>\n      {props.icon && (\n        <span className={classNames(\"icon\", props.iconBg)}>\n          <FontAwesomeIcon icon={props.icon} />\n        </span>\n      )}\n      <div className={ styles.history }>\n        <span className={ 'text-muted' }>{props.history}</span>\n      </div>\n    </>\n  );\n\n  content = (\n    <div className={ styles.dashboardWidget }>\n      { content }\n    </div>\n  );\n\n  if (!props.tooltip) {\n    return content;\n  }\n\n  const tooltip = (\n    <Tooltip id='counterTooltip'>\n      { props.tooltip }\n    </Tooltip>\n  );\n\n  return (\n    <OverlayTrigger\n      delay={{ show: 50, hide: 0 }}\n      overlay={ tooltip }\n    >\n      { content }\n    </OverlayTrigger>\n  );\n};\n","import React, { useContext } from 'react'\nimport { Container, Row, Col } from 'react-bootstrap'\nimport { BarChart, XAxis, YAxis, Bar, Tooltip, ResponsiveContainer, Label } from 'recharts'\n\nimport useGlobalState from 'store/state';\nimport RealtimeChart from './RealtimeChart';\nimport { forHumans } from 'lib/secondsToHuman';\nimport { SocketContext } from 'util/socketProvider';\nimport { EVENTS } from 'store/types';\nimport Widget from './Widget';\n\nexport const MAX_STATS_BARS = 100;\n\ntype Stat = {\n  header: string,\n  data: string | number,\n  detail?: string,\n  tooltip?: string,\n}\n\nexport default () => {\n  const { state } = useGlobalState()\n\n  const { socket } = useContext(SocketContext)\n\n  const totalTime = state.stats.timeActive + state.stats.timeInactive\n\n  const statsData: Stat[][] = [\n    [\n      {\n        header: 'Time Active / Session',\n        data: forHumans(Math.round(state.stats.timeActive / state.stats.sessions)),\n        detail: 'Total: ' + forHumans(state.stats.timeActive) + ' (' + Math.round(state.stats.timeActive * 100 / totalTime) + '%)'\n      },\n      {\n        header: 'Time Inactive / Session',\n        data: forHumans(Math.round(state.stats.timeInactive / state.stats.sessions)),\n        detail: 'Total: ' + forHumans(state.stats.timeInactive) + ' (' + Math.round(state.stats.timeInactive * 100 / totalTime) + '%)'\n      },\n    ],\n    [\n      {\n        header: 'Users Online',\n        data: Math.round(state.stats.onlineUsers * 100 / state.stats.totalUsers) + '%',\n        detail: `${state.stats.onlineUsers} out of ${state.stats.totalUsers}`,\n        tooltip: '',\n      },\n      {\n        header: 'Total Messages',\n        data: state.stats.totalMessages,\n        detail: Math.round(state.stats.totalMessages / state.stats.totalUsers) + ' messages / user'\n      },\n      {\n        header: 'Server',\n        data: 'CPU: ' + state.stats.cpuUsage + '% - RAM: ' + state.stats.freeMemory + '%',\n        detail: 'Up for ' + forHumans(state.stats.uptime),\n        tooltip: 'Shows CPU usage over the last few seconds, and free RAM',\n      },\n      {\n        header: 'Avg Sessions / user',\n        data: Math.round(state.stats.sessions / state.stats.totalUsers),\n        detail: 'Total sessions: ' + state.stats.sessions\n      },\n    ],\n  ]\n\n  const roomData = state.stats.rooms\n\n  const onRoomClick = (event: any) => {\n    if (!event) {\n      return\n    }\n    const room = event.activePayload[0].payload.id\n    if (socket) {\n      socket.emit(EVENTS.CHANGE_ROOM, {\n        room,\n      })\n    }\n  }\n\n  return (\n    <Container fluid>\n      <Row>\n        <Col>\n          <RealtimeChart\n            data={ state.stats.messages }\n            label='Realtime Messages'\n          />\n        </Col>\n        <Col>\n          <RealtimeChart\n            data={ state.stats.users }\n            label='Realtime Users'\n          />\n        </Col>\n      </Row>\n      <Row>\n        <Col>\n          <div style={ { width: '100%', height: '400px' } }>\n            <ResponsiveContainer>\n              <BarChart onClick={ onRoomClick } data={roomData} barSize={ 10 } margin={{ top: 50, bottom: 0, left: 0, right: 0}}>\n                <YAxis allowDecimals={ false } domain={ [ 0, 10 ] } />\n                <XAxis tick={false}>\n                  <Label value='Rooms' position=\"bottom\" offset={ -15 } fill='#ccc' />\n                </XAxis>\n                <Bar dataKey=\"active\" stackId='a' fill=\"#f75f00\" />\n                <Bar dataKey=\"inactive\" stackId='a' fill=\"#555\" />\n                <Tooltip cursor={ { fill: 'rgba(255, 255, 255, 0.1)' } }/>\n              </BarChart>\n            </ResponsiveContainer>\n          </div>\n        </Col>\n      </Row>\n      <Container className='mt-4'>\n        { statsData.map((row, index) => (\n          <Row key={ index }>\n            { row.map(stats => (\n              <Col key={ stats.header }>\n                <Widget\n                  title={ stats.header }\n                  content={ stats.data }\n                  history={ stats.detail }\n                  tooltip={ stats.tooltip }\n                />\n              </Col>\n            )) }\n          </Row>\n        )) }\n      </Container>\n    </Container>\n  )\n}","// @ts-nocheck\n/* eslint-disable */\n\n/**\n * pSBC v4.0\n * ===============\n * How to use and source:\n * https://github.com/PimpTrizkit/PJs/wiki/12.-Shade,-Blend-and-Convert-a-Web-Color-(pSBC.js)#usages\n */\nexport const pSBC = (\n  p: number,\n  c0: string,\n  c1: string = null,\n  l: boolean = false\n) => {\n  let r,\n    g,\n    b,\n    P,\n    f,\n    t,\n    h,\n    i = parseInt,\n    m = Math.round,\n    a = typeof c1 == 'string'\n  if (\n    typeof p != 'number' ||\n    p < -1 ||\n    p > 1 ||\n    typeof c0 != 'string' ||\n    (c0[0] != 'r' && c0[0] != '#') ||\n    (c1 && !a)\n  )\n    return null\n  if (!window.pSBCr)\n    window.pSBCr = (d) => {\n      let n = d.length,\n        x = {}\n      if (n > 9) {\n        ;([r, g, b, a] = d = d.split(',')), (n = d.length)\n        if (n < 3 || n > 4) return null\n        ;(x.r = i(r[3] == 'a' ? r.slice(5) : r.slice(4))),\n          (x.g = i(g)),\n          (x.b = i(b)),\n          (x.a = a ? parseFloat(a) : -1)\n      } else {\n        if (n == 8 || n == 6 || n < 4) return null\n        if (n < 6)\n          d =\n            '#' +\n            d[1] +\n            d[1] +\n            d[2] +\n            d[2] +\n            d[3] +\n            d[3] +\n            (n > 4 ? d[4] + d[4] : '')\n        d = i(d.slice(1), 16)\n        if (n == 9 || n == 5)\n          (x.r = (d >> 24) & 255),\n            (x.g = (d >> 16) & 255),\n            (x.b = (d >> 8) & 255),\n            (x.a = m((d & 255) / 0.255) / 1000)\n        else\n          (x.r = d >> 16), (x.g = (d >> 8) & 255), (x.b = d & 255), (x.a = -1)\n      }\n      return x\n    }\n  ;(h = c0.length > 9),\n    (h = a ? (c1.length > 9 ? true : c1 == 'c' ? !h : false) : h),\n    (f = window.pSBCr(c0)),\n    (P = p < 0),\n    (t =\n      c1 && c1 != 'c'\n        ? window.pSBCr(c1)\n        : P\n        ? { r: 0, g: 0, b: 0, a: -1 }\n        : { r: 255, g: 255, b: 255, a: -1 }),\n    (p = P ? p * -1 : p),\n    (P = 1 - p)\n  if (!f || !t) return null\n  if (l)\n    (r = m(P * f.r + p * t.r)),\n      (g = m(P * f.g + p * t.g)),\n      (b = m(P * f.b + p * t.b))\n  else\n    (r = m((P * f.r ** 2 + p * t.r ** 2) ** 0.5)),\n      (g = m((P * f.g ** 2 + p * t.g ** 2) ** 0.5)),\n      (b = m((P * f.b ** 2 + p * t.b ** 2) ** 0.5))\n  ;(a = f.a),\n    (t = t.a),\n    (f = a >= 0 || t >= 0),\n    (a = f ? (a < 0 ? t : t < 0 ? a : a * P + t * p) : 0)\n  if (h)\n    return (\n      'rgb' +\n      (f ? 'a(' : '(') +\n      r +\n      ',' +\n      g +\n      ',' +\n      b +\n      (f ? ',' + m(a * 1000) / 1000 : '') +\n      ')'\n    )\n  else\n    return (\n      '#' +\n      (4294967296 + r * 16777216 + g * 65536 + b * 256 + (f ? m(a * 255) : 0))\n        .toString(16)\n        .slice(1, f ? undefined : -2)\n    )\n}\n","import { getRgbLuminance } from './getRgbLuminance'\nimport { hex2Rgb } from './hex2rgb'\nimport { pSBC } from './psbc'\n\ntype rgbColor = {\n  r: number\n  g: number\n  b: number\n}\n\n/*eslint-disable */\nconst demoInConsole = (color: string, colorRgb: rgbColor) => {\n  // Make sure to replicate the formula changes you do above, here\n  const forLight = pSBC(getThemeOffset(colorRgb, true), color, '#000000')\n  const forDark = pSBC(getThemeOffset(colorRgb, false), color, '#ffffff')\n\n  console.log(color, colorRgb)\n  // Current on dark\n  console.log(\n    `%c (${forDark !== color ? '<' : '='}) @jaicab ☃ ★ ♖`,\n    `background:#293134; color: ${color}; display: block; padding: 1em; font-size: 1.5em`\n  )\n  // New on dark\n  if (forDark !== color)\n    console.log(\n      `%c (>) @jaicab ☃ ★ ♖`,\n      `background:#293134; color: ${forDark}; display: block; padding: 1em; font-size: 1.5em`\n    )\n  // Current on light\n  console.log(\n    `%c (${forLight !== color ? '<' : '='}) @jaicab ☃ ★ ♖`,\n    `background:#fcfcfc; color: ${color}; display: block; padding: 1em; font-size: 1.5em`\n  )\n  // New on light\n  if (forLight !== color)\n    console.log(\n      '%c (>) @jaicab ☃ ★ ♖',\n      `background:#fcfcfc; color: ${forLight}; display: block; padding: 1em; font-size: 1.5em`\n    )\n}\n/*eslint-enable */\n\n// Returns number between 0 and 1\nconst getThemeOffset = (colorRgb: rgbColor, lightMode: boolean) => {\n  const lum = getRgbLuminance(colorRgb.r, colorRgb.g, colorRgb.b)\n  let offset = 0\n  // Only change color if luminance difference in the 50% range to theme\n  if (lightMode && lum >= 0.5) offset = -lum\n  else if (!lightMode && lum < 0.5) offset = lum + 0.2\n\n  return offset\n}\n\n/**\n * Takes a HEX string (with or without pound) and returns a colour visible in the theme background\n */\nexport const makeColorReadable = (color: string) => {\n  const colorRgb = hex2Rgb(color) as rgbColor\n  const isLightMode =\n    window.matchMedia &&\n    window.matchMedia('(prefers-color-scheme: light)').matches\n\n  if (!colorRgb) return '#0000FF' // fail\n\n  const offset = getThemeOffset(colorRgb, isLightMode)\n  const readableColor = offset && pSBC(offset, color)\n\n  // !Demo\n  // demoInConsole(color, colorRgb)\n\n  return readableColor || color\n}\n","/**\n * Calculates luminance for { r, g, b } passed\n * Returns value 0-1\n */\nexport const getRgbLuminance = (r: number, g: number, b: number) => {\n  const a = [r, g, b].map(function (v) {\n    v /= 255\n    return v <= 0.03928 ? v / 12.92 : Math.pow((v + 0.055) / 1.055, 2.4)\n  })\n  return a[0] * 0.2126 + a[1] * 0.7152 + a[2] * 0.0722\n}\n","/**\n * hex2Rgb\n * Takes string, returns { r, g, b }\n */\nexport const hex2Rgb = (hex: string) => {\n  const result = /^#?([a-f\\d]{2})([a-f\\d]{2})([a-f\\d]{2})$/i.exec(hex)\n  return result\n    ? {\n        r: parseInt(result[1], 16),\n        g: parseInt(result[2], 16),\n        b: parseInt(result[3], 16),\n      }\n    : null\n}\n","import produce from 'immer'\nimport { v4 as uuidv4 } from 'uuid'\n\nimport {\n  AppState,\n  Action,\n  Message,\n  EVENTS,\n  User,\n  IncomingMessage,\n} from './types'\nimport { MAX_MESSAGE_HISTORY } from '../constants'\nimport { MAX_STATS_BARS } from 'sections/Admin'\nimport { makeColorReadable } from 'lib/color/makeColorReadable'\n\n// TODO NEW BLOG POST\n// const REDUCER = {\n//   [REDUX_CONSTANTS.LOGIN]: (draft, payload) => {},\n// };\n\nexport default produce((draft: AppState, action: Action) => {\n  // REDUCER[action.type](draft, action.payload);\n  // console.log('REDUCER', action)\n\n  switch (action.type) {\n    case 'login':\n      if (!draft.offline) {\n        draft.auth.checked = true\n      }\n\n      if (!action.payload) {\n        draft.auth.loggedIn = false\n        draft.auth.user = null\n        break\n      }\n\n      draft.offline = false\n\n      draft.auth.loggedIn = true\n      draft.auth.user = action.payload.user\n      break\n    case 'offline':\n      draft.offline = true\n      draft.error = null\n      draft.socket.connected = false\n      break\n    case 'error':\n      draft.error = action.payload\n      break\n    case 'user_password':\n      if (draft.auth.user) {\n        draft.auth.user.hasPassword = true\n      }\n      break\n    case 'system_message':\n      const systemMessage = {\n        uuid: uuidv4(),\n        user: systemUser,\n        content: [action.payload],\n        timestamp: new Date(),\n        attributes: {\n          private: false,\n          draft: false,\n        },\n      }\n      draft.messages.push(systemMessage)\n      break\n    case `socket_${EVENTS.CONNECT}`:\n      draft.socket.connected = true\n      draft.offline = false\n      draft.error = null\n      break\n    case `socket_${EVENTS.DISCONNECT}`:\n      draft.socket.connected = false\n      draft.offline = true\n      draft.error = null\n      break\n    case `socket_${EVENTS.ONLINE_USERS}`:\n      draft.onlineUsers = action.payload.users.map((user: User) => {\n        user.contrastColor = makeColorReadable('#' + user.color)\n        return user\n      })\n      break\n    case `socket_${EVENTS.MESSAGE}`:\n      const incomingMessage: IncomingMessage = action.payload\n      incomingMessage.timestamp = new Date(incomingMessage.timestamp)\n\n      // delete draft from this user, and if the draft is past messages, keep it there\n      // this way if multiple users are typing, their drafts don't keep jumping around\n      let draftIsPastMessage = false;\n      let draftIndex = -1;\n      for (let i = draft.messages.length - 1; i >= 0; i--) {\n        const eachMessage = draft.messages[i]\n        if (!eachMessage.attributes.draft) {\n          draftIsPastMessage = true\n        }\n        if (\n          eachMessage.attributes.draft &&\n          eachMessage.user.user_id === incomingMessage.user.user_id\n        ) {\n          draftIndex = i\n          break\n        }\n      }\n\n      const isEmpty = incomingMessage.content.trim().length < 1\n\n      if (draftIndex > -1) {\n        if (draftIsPastMessage || !incomingMessage.attributes.draft) {\n          draft.messages.splice(draftIndex, 1)\n        } else if (!isEmpty && incomingMessage.attributes.draft) {\n          draft.messages[draftIndex].content[0] = incomingMessage.content\n          draft.messages[draftIndex].timedContent = incomingMessage.timedContent\n          draft.messages[draftIndex].timestamp = new Date(\n            incomingMessage.timestamp\n          )\n          return\n        }\n      }\n\n      if (isEmpty) {\n        return\n      }\n\n      if (incomingMessage.attributes.replyToId) {\n        const messageReply =\n          draft.messages.find(\n            (eachMessage) =>\n              eachMessage.uuid ===\n              incomingMessage.attributes.replyToId\n          ) || null\n        if (messageReply && messageReply.user) {\n          incomingMessage.attributes.replyTo = messageReply\n        }\n      }\n\n      if (!incomingMessage.attributes.draft) {\n        const lastMessage = draft.messages[draft.messages.length - 1]\n\n        if (\n          lastMessage &&\n          lastMessage.user.user_id === incomingMessage.user.user_id &&\n          lastMessage.attributes.private ===\n            incomingMessage.attributes.private &&\n          lastMessage.attributes.replyToId ===\n            incomingMessage.attributes.replyToId\n        ) {\n          // last message was by this same user (and it's the same kind of message)\n          lastMessage.content.push(incomingMessage.content)\n          lastMessage.timestamp = new Date(incomingMessage.timestamp)\n          return\n        }\n      }\n\n      const message: Message = {\n        uuid: incomingMessage.uuid,\n        user: incomingMessage.user,\n        timestamp: incomingMessage.timestamp,\n        attributes: incomingMessage.attributes,\n        content: [incomingMessage.content],\n      }\n\n      if (incomingMessage.attributes.draft) {\n        message.timedContent = incomingMessage.timedContent\n      }\n\n      draft.messages.push(message)\n\n      if (draft.messages.length > MAX_MESSAGE_HISTORY) {\n        draft.messages.shift()\n      }\n      break\n    case `socket_${EVENTS.HISTORY}`:\n      draft.messages = action.payload.map((eachMessage: Message) => {\n        eachMessage.timestamp = new Date(eachMessage.timestamp)\n        return eachMessage\n      })\n      break\n    case `socket_${EVENTS.STATS}`:\n      draft.stats.messages.push(action.payload.messages)\n      if (draft.stats.messages.length > MAX_STATS_BARS) {\n        draft.stats.messages.shift()\n      }\n\n      draft.stats.users.push(action.payload.users)\n      if (draft.stats.users.length > MAX_STATS_BARS) {\n        draft.stats.users.shift()\n      }\n\n      draft.stats.rooms = action.payload.rooms\n      draft.stats.onlineUsers = action.payload.users\n      draft.stats.totalUsers = action.payload.totalUsers\n      draft.stats.totalMessages = action.payload.totalMessages\n      draft.stats.cpuUsage = Math.round(action.payload.cpuUsage * 100)\n      draft.stats.freeMemory = Math.round(action.payload.freeMemory * 100)\n      draft.stats.uptime = Math.round(action.payload.uptime)\n      draft.stats.timeActive = action.payload.timeActive * 30\n      draft.stats.timeInactive = action.payload.timeInactive * 30\n      draft.stats.sessions = action.payload.sessions\n      break\n    case `socket_${EVENTS.CONTROL}`:\n      Object.keys(action.payload).forEach((key) => {\n        if (typeof draft[key] !== 'undefined') {\n          draft[key] = action.payload[key]\n        }\n      })\n      break\n    case 'chat_focus':\n      draft.chat.focused = action.payload\n      break\n  }\n})\n\nconst systemUser: User = {\n  user_id: 'dotdot',\n  name: 'dotdot',\n  icon: 'cog',\n  color: 'f75f00',\n  isActive: true,\n  hasPassword: true,\n}\n","import React from 'react'\n\nimport reducer from './reducer'\nimport { AppState, AppContext, Action } from './types'\nimport { MAX_STATS_BARS } from 'sections/Admin'\n\nexport const initialState: AppState = {\n  auth: {\n    checked: false,\n    loggedIn: false,\n    user: null,\n  },\n  socket: {\n    connected: false,\n  },\n  draftTimer: 250,\n  onlineUsers: [],\n  messages: [],\n  stats: {\n    messages: new Array(MAX_STATS_BARS).fill(0),\n    users: new Array(MAX_STATS_BARS).fill(0),\n    rooms: [],\n    onlineUsers: 0,\n    totalUsers: 0,\n    totalMessages: 0,\n    cpuUsage: 0,\n    freeMemory: 0,\n    uptime: 0,\n    timeActive: 0,\n    timeInactive: 0,\n    sessions: 1,\n  },\n  offline: false,\n  error: null,\n  chat: {\n    focused: false\n  }\n}\nconst defaultDispatch: React.Dispatch<Action> = () => {\n  console.warn('Using default reducer, check StateProvider')\n  return initialState\n}\nexport const StateContext = React.createContext<AppContext>({\n  state: initialState,\n  dispatch: defaultDispatch,\n})\n\ntype Props = {\n  state?: AppState,\n  children: any\n}\n\nexport const StateProvider = (props: Props) => {\n  const [state, dispatch] = React.useReducer(reducer, props.state || initialState)\n  // TODO: if value is not \"any\" then typescript has an issue with readonly state values\n  const value: any = { state, dispatch }\n  return (\n    <StateContext.Provider value={value}>\n      {props.children}\n    </StateContext.Provider>\n  )\n}\n\nexport const useGlobalState = (): AppContext => React.useContext(StateContext)\nexport default useGlobalState\n","import React from 'react'\n\nimport styles from './index.module.scss'\n\ntype Props = {\n  infinite?: boolean\n}\n\nexport default (props: Props) => {\n  const style: any = {}\n  if (props.infinite) {\n    style.animationIterationCount = 'infinite'\n    style.animationDirection = 'alternate'\n  }\n  return (\n    <>\n      <div className={styles.logo}>\n        <div className={styles.blob} style={style}></div>\n        <div className={styles.blob} style={style}></div>\n      </div>\n\n      <svg\n        className={styles.svgFilter}\n        xmlns=\"http://www.w3.org/2000/svg\"\n        version=\"1.1\"\n      >\n        <defs>\n          <filter id=\"goo\">\n            <feGaussianBlur\n              in=\"SourceGraphic\"\n              stdDeviation=\"10\"\n              result=\"blur\"\n            />\n            <feColorMatrix\n              in=\"blur\"\n              mode=\"matrix\"\n              values=\"1 0 0 0 0  0 1 0 0 0  0 0 1 0 0  0 0 0 18 -7\"\n              result=\"goo\"\n            />\n            <feBlend in=\"SourceGraphic\" in2=\"goo\" />\n          </filter>\n        </defs>\n      </svg>\n    </>\n  )\n}\n","import React from 'react'\nimport LogoAnimation from 'components/LogoAnimation'\n\ntype Props = {\n  text?: string | null\n}\n\nexport default (props: Props) => {\n  return (\n    <div\n      style={{\n        position: 'absolute',\n        top: '45%',\n        left: '50%',\n        transform: 'translateX(-50%) translateY(-50%)',\n      }}\n    >\n      <LogoAnimation infinite />\n    </div>\n  )\n}\n","import React from 'react'\n\ntype Props = {\n  className: string\n}\n\nexport default ({ className }: Props) => {\n  const theme = window.matchMedia('(prefers-color-scheme: light)').matches\n    ? 'light'\n    : 'dark'\n  const lettersColor = theme === 'light' ? '282B2D' : 'F3F3F3'\n\n  return (\n    <svg\n      className={className}\n      xmlns=\"http://www.w3.org/2000/svg\"\n      width=\"717\"\n      height=\"139\"\n      viewBox=\"0 0 717 139\"\n    >\n      <defs>\n        <path\n          id=\"main-black-a\"\n          d=\"M29.0928934,85.7089474 C35.276613,85.7089474 40.4425154,84.2681579 44.5906006,81.3865789 C45.0197129,81.0884846 45.4378302,80.7792888 45.8449525,80.4589915 L45.9155783,80.402 L45.9156834,83.98 L59.7426341,83.98 L59.7426341,0.99052624 L43.9568654,0.99052624 L43.9562341,23.746 L43.6237812,23.5352083 C39.952661,21.2683262 35.567712,20.0944052 30.468934,20.0134451 L29.8994655,20.0089473 C23.9461951,20.0089473 18.7610886,21.4305263 14.344146,24.2736842 C9.9272034,27.1168421 6.49927187,31.0069736 4.0603514,35.9440789 C1.62143093,40.8811842 0.401970697,46.5194736 0.401970697,52.8589473 C0.401970697,59.0831579 1.60222683,64.673421 4.00273911,69.6297368 C6.40325138,74.5860526 9.75436651,78.505 14.0560845,81.3865789 C18.3578025,84.2681579 23.3700721,85.7089474 29.0928934,85.7089474 Z M31.6278343,71.7621053 C28.2479131,71.7621053 25.4825229,70.9168421 23.3316639,69.2263158 C21.1808049,67.5357895 19.5868648,65.2593421 18.5498435,62.3969737 C17.5128222,59.5346052 16.9943115,56.3552631 16.9943115,52.8589473 C16.9943115,49.4010526 17.5320263,46.240921 18.6074558,43.3785526 C19.6828853,40.5161842 21.3440398,38.2301315 23.5909193,36.5203947 C25.8377987,34.8106578 28.7088114,33.9557894 32.2039573,33.9557894 C35.468654,33.9557894 38.1092175,34.743421 40.1256478,36.3186842 C42.1420781,37.8939473 43.6111916,40.1031579 44.5329883,42.9463158 C45.454785,45.7894736 45.9156834,49.0936842 45.9156834,52.8589473 C45.9156834,56.6242105 45.454785,59.928421 44.5329883,62.7715789 C43.6111916,65.6147368 42.1036699,67.8239474 40.0104232,69.3992105 C37.9171765,70.9744737 35.1229802,71.7621053 31.6278343,71.7621053 Z M102.374154,85.7089474 C108.596281,85.7089474 114.079051,84.3161842 118.822464,81.5306579 C123.565876,78.7451316 127.272267,74.8838158 129.941637,69.9467105 C132.611006,65.0096052 133.945691,59.3136842 133.945691,52.8589473 C133.945691,46.4426315 132.620608,40.765921 129.970443,35.8288157 C127.320277,30.8917105 123.623488,27.0207894 118.880076,24.2160526 C114.136664,21.4113157 108.63469,20.0089473 102.374154,20.0089473 C96.2288422,20.0089473 90.7940824,21.3921052 86.0698743,24.158421 C81.3456661,26.9247368 77.6392752,30.7764473 74.9507014,35.7135526 C72.2621277,40.6506579 70.9178408,46.3657894 70.9178408,52.8589473 C70.9178408,59.2752631 72.2333215,64.9519737 74.864283,69.8890789 C77.4952444,74.8261842 81.1728292,78.6971053 85.8970374,81.5018421 C90.6212455,84.3065789 96.1136176,85.7089474 102.374154,85.7089474 Z M102.374154,71.0705263 C97.4963127,71.0705263 93.7995238,69.4280263 91.2837869,66.1430263 C88.7680501,62.8580263 87.5101816,58.43 87.5101816,52.8589473 C87.5101816,49.2473684 88.0382943,46.0776315 89.0945197,43.3497368 C90.1507451,40.6218421 91.7734914,38.4894736 93.9627586,36.9526315 C96.1520258,35.4157894 98.9558242,34.6473684 102.374154,34.6473684 C107.328811,34.6473684 111.064008,36.2994736 113.579745,39.6036842 C116.095482,42.9078947 117.35335,47.3263158 117.35335,52.8589473 C117.35335,58.1994737 116.114686,62.5698684 113.637357,65.9701316 C111.160029,69.3703947 107.405627,71.0705263 102.374154,71.0705263 Z M170.807431,85.0461842 C174.936312,85.1422368 179.151612,84.7868421 183.45333,83.98 L183.45333,83.98 L183.45333,70.9552631 C179.766143,71.4547368 176.405426,71.608421 173.371178,71.4163158 C170.336931,71.2242105 168.12846,70.0331579 166.745765,67.8431579 C166.016009,66.6905263 165.622325,65.1440789 165.564713,63.2038158 C165.5071,61.2635526 165.478294,59.0831579 165.478294,56.6626316 L165.478294,56.6626316 L165.477558,33.841 L183.45333,33.8405263 L183.45333,21.7378947 L165.477558,21.738 L165.478294,4.44842098 L149.80775,4.44842098 L149.806803,21.738 L139.207088,21.7378947 L139.207088,33.8405263 L149.806803,33.841 L149.80775,57.5847368 C149.80775,61.0248988 149.840477,64.1295017 149.90593,66.8985456 L149.922975,67.5838158 C149.999791,70.5230263 150.806363,73.4142105 152.342691,76.2573684 C154.032652,79.2926316 156.500378,81.4922368 159.745871,82.8561842 C162.991363,84.2201316 166.67855,84.9501316 170.807431,85.0461842 Z M222.556557,85.7089474 C228.740277,85.7089474 233.906179,84.2681579 238.054264,81.3865789 C238.483376,81.0884846 238.901494,80.7792888 239.308616,80.4589915 L239.378821,80.402 L239.379347,83.98 L253.206298,83.98 L253.206298,0.99052624 L237.420529,0.99052624 L237.420476,23.747 L237.087445,23.5352083 C233.416325,21.2683262 229.031375,20.0944052 223.932597,20.0134451 L223.363129,20.0089473 C217.409859,20.0089473 212.224752,21.4305263 207.807809,24.2736842 C203.390867,27.1168421 199.962935,31.0069736 197.524015,35.9440789 C195.085094,40.8811842 193.865634,46.5194736 193.865634,52.8589473 C193.865634,59.0831579 195.06589,64.673421 197.466403,69.6297368 C199.866915,74.5860526 203.21803,78.505 207.519748,81.3865789 C211.821466,84.2681579 216.833736,85.7089474 222.556557,85.7089474 Z M225.091498,71.7621053 C221.711577,71.7621053 218.946186,70.9168421 216.795327,69.2263158 C214.644468,67.5357895 213.050528,65.2593421 212.013507,62.3969737 C210.976486,59.5346052 210.457975,56.3552631 210.457975,52.8589473 C210.457975,49.4010526 210.99569,46.240921 212.071119,43.3785526 C213.146549,40.5161842 214.807703,38.2301315 217.054583,36.5203947 C219.301462,34.8106578 222.172475,33.9557894 225.667621,33.9557894 C228.932317,33.9557894 231.572881,34.743421 233.589311,36.3186842 C235.605742,37.8939473 237.074855,40.1031579 237.996652,42.9463158 C238.918449,45.7894736 239.379347,49.0936842 239.379347,52.8589473 C239.379347,56.6242105 238.918449,59.928421 237.996652,62.7715789 C237.074855,65.6147368 235.567333,67.8239474 233.474087,69.3992105 C231.38084,70.9744737 228.586644,71.7621053 225.091498,71.7621053 Z M295.837817,85.7089474 C302.059945,85.7089474 307.542715,84.3161842 312.286127,81.5306579 C317.029539,78.7451316 320.73593,74.8838158 323.4053,69.9467105 C326.07467,65.0096052 327.409355,59.3136842 327.409355,52.8589473 C327.409355,46.4426315 326.084272,40.765921 323.434106,35.8288157 C320.783941,30.8917105 317.087152,27.0207894 312.34374,24.2160526 C307.600327,21.4113157 302.098353,20.0089473 295.837817,20.0089473 C289.692506,20.0089473 284.257746,21.3921052 279.533538,24.158421 C274.80933,26.9247368 271.102939,30.7764473 268.414365,35.7135526 C265.725791,40.6506579 264.381504,46.3657894 264.381504,52.8589473 C264.381504,59.2752631 265.696985,64.9519737 268.327947,69.8890789 C270.958908,74.8261842 274.636493,78.6971053 279.360701,81.5018421 C284.084909,84.3065789 289.577281,85.7089474 295.837817,85.7089474 Z M295.837817,71.0705263 C290.959976,71.0705263 287.263187,69.4280263 284.74745,66.1430263 C282.231714,62.8580263 280.973845,58.43 280.973845,52.8589473 C280.973845,49.2473684 281.501958,46.0776315 282.558183,43.3497368 C283.614409,40.6218421 285.237155,38.4894736 287.426422,36.9526315 C289.615689,35.4157894 292.419488,34.6473684 295.837817,34.6473684 C300.792474,34.6473684 304.527672,36.2994736 307.043408,39.6036842 C309.559145,42.9078947 310.817014,47.3263158 310.817014,52.8589473 C310.817014,58.1994737 309.578349,62.5698684 307.101021,65.9701316 C304.623692,69.3703947 300.869291,71.0705263 295.837817,71.0705263 Z M364.271095,85.0461842 C368.399976,85.1422368 372.615276,84.7868421 376.916994,83.98 L376.916994,83.98 L376.916994,70.9552631 C373.229807,71.4547368 369.86909,71.608421 366.834842,71.4163158 C363.800594,71.2242105 361.592123,70.0331579 360.209428,67.8431579 C359.479672,66.6905263 359.085988,65.1440789 359.028376,63.2038158 C358.970764,61.2635526 358.941958,59.0831579 358.941958,56.6626316 L358.941958,56.6626316 L358.9418,33.841 L376.916994,33.8405263 L376.916994,21.7378947 L358.9418,21.738 L358.941958,4.44842098 L343.271414,4.44842098 L343.271045,21.738 L332.670751,21.7378947 L332.670751,33.8405263 L343.271045,33.841 L343.271414,57.5847368 C343.271414,61.0248988 343.30414,64.1295017 343.369593,66.8985456 L343.386638,67.5838158 C343.463455,70.5230263 344.270027,73.4142105 345.806354,76.2573684 C347.496315,79.2926316 349.964042,81.4922368 353.209534,82.8561842 C356.455027,84.2201316 360.142214,84.9501316 364.271095,85.0461842 Z\"\n        />\n      </defs>\n      <g fill=\"none\" fillRule=\"evenodd\">\n        <g transform=\"translate(339.337 25.02)\">\n          <mask id=\"main-black-b\" fill=\"#fff\">\n            <use xlinkHref=\"#main-black-a\" />\n          </mask>\n          <use\n            fill=\"#FFF\"\n            fillRule=\"nonzero\"\n            opacity=\".9\"\n            xlinkHref=\"#main-black-a\"\n          />\n          <g fill={`#${lettersColor}`} mask=\"url(#main-black-b)\">\n            <rect\n              width=\"377.177\"\n              height=\"86.18\"\n              transform=\"translate(0 -.158)\"\n            />\n          </g>\n        </g>\n        <g transform=\"translate(0 1)\">\n          <ellipse\n            cx=\"217.427\"\n            cy=\"69.5\"\n            fill=\"#FF5151\"\n            rx=\"67.477\"\n            ry=\"67.5\"\n          />\n          <ellipse cx=\"67.477\" cy=\"67.5\" fill=\"#4DCBC3\" rx=\"67.477\" ry=\"67.5\" />\n        </g>\n      </g>\n    </svg>\n  )\n}\n","import React from 'react'\nimport classNames from 'classnames'\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome'\n\nimport useGlobalState from 'store/state'\nimport { IconProp } from '@fortawesome/fontawesome-svg-core'\n\nimport styles from './index.module.scss'\n\ntype Props = {\n  onClick: () => void\n  small?: boolean\n}\n\nexport default ({ onClick, small }: Props) => {\n  const { state } = useGlobalState()\n\n  if (!state.auth.user) return <></>\n\n  const isLocked = state.auth.user && state.auth.user.hasPassword\n  const icon: IconProp = isLocked ? 'lock' : 'lock-open'\n\n  return (\n    <button className={styles.badge} onClick={onClick}>\n      <span\n        className={ styles.dot }\n        style={{ color: `#${state.auth.user.color}` }}\n      >\n        <FontAwesomeIcon icon={ state.auth.user.icon || 'circle' } />\n      </span>\n      <span className={styles.name}>{state.auth.user.name}</span>\n      <FontAwesomeIcon\n        className={classNames(styles.lock, {\n          [styles.closed]: isLocked,\n        })}\n        icon={icon}\n      />\n    </button>\n  )\n}\n","import React from 'react'\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome'\n\nimport styles from './index.module.scss'\n\nexport default () => (\n  <a\n    className={styles.badge}\n    href=\"/admin\"\n    title=\"Monitoring\"\n    style={{ marginLeft: '1em' }}\n  >\n    <FontAwesomeIcon className={styles.icon} icon=\"shield-alt\" />\n  </a>\n)\n","import { useEffect, useState } from 'react'\nimport axios, { AxiosRequestConfig, AxiosError } from 'axios'\n\nimport { API_URL } from '../constants'\nimport useGlobalState from 'store/state'\n\nexport type FetchMethod = 'GET' | 'POST' | 'PUT' | 'DELETE'\nexport const CSRF_HEADER = 'x-csrf-token'\nlet csrfToken = ''\n\nexport type FetchError = {\n  status: number\n  message: string\n  errors: string[]\n  data?: any\n}\n\ntype FetchReturn<T> = [boolean, T | null, FetchError | null]\n\naxios.defaults.withCredentials = true\n\nfunction useFetch<T>(\n  path: string,\n  method: FetchMethod,\n  body?: any\n): FetchReturn<T> {\n  const { dispatch } = useGlobalState()\n  const [error, setError] = useState<FetchError | null>(null)\n  const [loading, setLoading] = useState<boolean>(true)\n  const [response, setResponse] = useState<T | null>(null)\n\n  useEffect(() => {\n    const sendRequest = async () => {\n      try {\n        const data = await fetchResource(path, method, body)\n        setResponse(data)\n      } catch (error) {\n        if (error.message === 'offline') {\n          dispatch({\n            type: 'offline',\n            payload: null\n          })\n        }\n        setError(error)\n      } finally {\n        setLoading(false)\n      }\n    }\n\n    sendRequest()\n  }, [path, method, body, dispatch])\n\n  return [loading, response, error]\n}\n\nexport const fetchResource = async (\n  path: string,\n  method: FetchMethod,\n  body?: any\n) => {\n  if (!path) {\n    throw new Error(`'url' is required for fetching data`)\n  }\n\n  const url = `${API_URL}${path}`\n  const options: AxiosRequestConfig = {\n    url,\n    method,\n    data: body,\n    timeout: 6000,\n    withCredentials: true,\n    xsrfHeaderName: CSRF_HEADER,\n    headers: {},\n  }\n\n  if (csrfToken.length > 0) {\n    options.headers[CSRF_HEADER] = csrfToken\n  }\n\n  try {\n    const response = await axios(options)\n\n    if (response.headers[CSRF_HEADER]) {\n      csrfToken = response.headers[CSRF_HEADER]\n    }\n\n    return await response.data\n  } catch (error) {\n    if (error.response) {\n      console.warn(`useFetch error on ${method} ${path}`, error.response)\n      const returnError: FetchError = {\n        status: error.response.status,\n        message: parseAxiosError(error),\n        errors: parseErrorList(error),\n        data: error.response.data\n      }\n      throw returnError\n    }\n\n    console.warn(`useFetch network error on ${method} ${path}`, error)\n    const returnError: FetchError = {\n      status: 500,\n      message: 'offline',\n      errors: [error.message],\n    }\n    throw returnError\n  }\n}\n\nfunction parseAxiosError(error: AxiosError): string {\n  if (!error.response || !error.response.data) {\n    return error.message || 'An error occurred'\n  }\n\n  return parseErrorList(error).join('. ')\n}\n\nfunction parseErrorList(error: AxiosError): string[] {\n  const defaultError = 'An error occurred'\n  if (!error.response || !error.response.data) {\n    return [error.message || defaultError]\n  }\n\n  return parseErrors(\n    defaultError,\n    error.response.data,\n    error.response.data.errors,\n    error.response.data.error\n  )\n}\n\nfunction parseErrors(defaultError: string, ...errors: any[]): string[] {\n  for (let i = 0; i < errors.length; i++) {\n    const error = errors[i]\n    if (Array.isArray(error)) return error\n    if (typeof error === 'string') return [error]\n  }\n\n  return [defaultError]\n}\n\nexport default useFetch\n","import React, { useState } from 'react'\nimport { Button, Modal, Form } from 'react-bootstrap'\nimport classNames from 'classnames'\n\nimport { fetchResource } from 'util/fetch'\nimport { API_URL } from '../../../../constants'\nimport useGlobalState from 'store/state'\n\nimport styles from './index.module.scss'\n\ntype Props = {\n  show: boolean\n  onHide: () => void\n}\n\nexport default ({ show, onHide }: Props) => {\n  const { state, dispatch } = useGlobalState()\n\n  const [validated, setValidated] = useState<boolean>(false)\n  const [password, setPassword] = useState<string>('')\n  const [repeatPassword, setRepeatPassword] = useState<string>('')\n\n  let title = 'Claim Username'\n\n  if (state.auth.user && state.auth.user.hasPassword) {\n    title = 'Update Password'\n  }\n\n  const handleSubmit = (event: React.ChangeEvent<HTMLFormElement>) => {\n    event.preventDefault()\n    event.stopPropagation()\n\n    setValidated(true)\n\n    const form = event.currentTarget\n    if (!form.checkValidity()) {\n      return\n    }\n\n    const body = {\n      password,\n      repeatPassword,\n    }\n\n    fetchResource('/password', 'POST', body)\n      .then(() => {\n        dispatch({\n          type: 'user_password',\n          payload: true,\n        })\n\n        onHide()\n        setValidated(false)\n        setPassword('')\n        setRepeatPassword('')\n      })\n      .catch((reason) => {\n        dispatch({\n          type: 'error',\n          payload: reason.errors.join(', '),\n        })\n      })\n  }\n\n  return (\n    <Modal show={show} onHide={onHide}>\n      <Form noValidate validated={validated} onSubmit={handleSubmit}>\n        <Modal.Header closeButton>\n          <Modal.Title>{title}</Modal.Title>\n        </Modal.Header>\n\n        <Modal.Body>\n          <Form.Group controlId=\"pwd.new\">\n            <Form.Control\n              as=\"input\"\n              type=\"password\"\n              autoComplete=\"new-password\"\n              placeholder=\"Password...\"\n              autoFocus\n              required\n              minLength={6}\n              onChange={(event) => {\n                setPassword(event.currentTarget.value)\n              }}\n              value={password}\n            />\n            <Form.Control.Feedback type=\"invalid\">\n              The password is too short. Minimum length is 6 characters.\n            </Form.Control.Feedback>\n          </Form.Group>\n\n          <Form.Group controlId=\"pwd.new\">\n            <Form.Control\n              as=\"input\"\n              type=\"password\"\n              autoComplete=\"new-password\"\n              placeholder=\"Repeat Password...\"\n              required\n              minLength={6}\n              pattern={password}\n              onChange={(event) => {\n                setRepeatPassword(event.currentTarget.value)\n              }}\n              value={repeatPassword}\n            />\n            <Form.Control.Feedback type=\"invalid\">\n              The passwords don't match!\n            </Form.Control.Feedback>\n          </Form.Group>\n        </Modal.Body>\n        <Modal.Footer className={styles.footer}>\n          <a\n            href={`${API_URL}/logout`}\n            className={classNames(styles.left, 'text-danger')}\n          >\n            Logout\n          </a>\n\n          <Button type=\"submit\" variant=\"primary\">\n            Set password\n          </Button>\n        </Modal.Footer>\n      </Form>\n    </Modal>\n  )\n}\n","import React, { useState } from 'react'\nimport { OverlayTrigger, Tooltip } from 'react-bootstrap'\nimport useGlobalState from 'store/state'\n\nimport UserBadge from './UserBadge'\nimport AdminBadge from './AdminBadge'\nimport PasswordModal from './PasswordModal'\n\ntype Props = {\n  children?: React.ReactNode\n}\n\nexport default ({ children }: Props) => {\n  const { state } = useGlobalState()\n\n  const [isOpen, setModalOpen] = useState<boolean>(false)\n\n  const handleClick = () => setModalOpen(true)\n  const handleClose = () => setModalOpen(false)\n\n  let tooltipText = 'Set a password to keep your username'\n\n  if (state.auth.user && state.auth.user.hasPassword) {\n    tooltipText = 'Change your password'\n  }\n\n  return (\n    <>\n      <AdminBadge />\n      {state.auth.user && state.auth.user.isAdmin && <AdminBadge />}\n      <OverlayTrigger\n        placement=\"bottom\"\n        delay={500}\n        overlay={<Tooltip id=\"passwordLock\">{tooltipText}</Tooltip>}\n      >\n        <UserBadge onClick={handleClick} />\n      </OverlayTrigger>\n\n      <PasswordModal show={isOpen} onHide={handleClose} />\n    </>\n  )\n}\n","import React from 'react'\nimport { IconProp, IconName } from '@fortawesome/fontawesome-svg-core'\nimport { OverlayTrigger, Tooltip } from 'react-bootstrap'\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome'\n\nimport useGlobalState from 'store/state'\nimport { User } from 'store/types'\n\ntype Props = {\n  user: User\n}\n\nexport default ({ user }: Props) => {\n  const { state } = useGlobalState()\n\n  const isCurrentUser =\n    state.auth.user && user.user_id === state.auth.user.user_id\n\n  let iconName: IconName = 'circle'\n  let inactive = ''\n\n  // Set icon\n  if (user.icon) {\n    iconName = user.icon\n  } else if (isCurrentUser) {\n    iconName = 'dot-circle'\n  }\n\n  // Set status\n  if (!user.isActive) {\n    iconName = 'meh'\n    inactive = ' (away)'\n  }\n\n  // TODO: Do we need this?\n  let icon: IconProp = iconName\n  if (isCurrentUser) {\n    icon = ['far', iconName]\n  }\n\n  const userColor = user.contrastColor || `#${user.color}`\n\n  return (\n    <OverlayTrigger\n      key={user.user_id}\n      placement=\"bottom\"\n      overlay={\n        <Tooltip id={`user-${user.user_id}`}>\n          @{user.name}\n          {inactive}\n        </Tooltip>\n      }\n    >\n      <FontAwesomeIcon style={{ color: userColor }} icon={icon} />\n    </OverlayTrigger>\n  )\n}\n","import React from 'react'\n\nimport styles from './index.module.scss'\nimport useGlobalState from 'store/state'\nimport User from './User'\n\nexport default () => {\n  const { state } = useGlobalState()\n\n  return (\n    <div className={styles.onlineUsers}>\n      <span className={styles.count}>{state.onlineUsers.length}</span>\n\n      {state.onlineUsers.map((user) => (\n        <User user={user} key={user.user_id} />\n      ))}\n    </div>\n  )\n}\n","import React from 'react'\n\nimport Logo from 'components/Logo'\n\nimport styles from './index.module.scss'\nimport Session from '../Session'\nimport OnlineUsers from '../OnlineUsers'\nimport { Container } from 'react-bootstrap'\n\ntype Props = {\n  scrollingWhileFocused?: boolean\n}\n\nexport default ({ scrollingWhileFocused }: Props) => {\n  const top = scrollingWhileFocused ? window.pageYOffset + 'px' : 0\n  const position = scrollingWhileFocused ? 'absolute' : 'fixed'\n\n  return (\n    <header className={styles.header} style={{ position, top }}>\n      <Container fluid className={styles.container}>\n        <Logo className={styles.logo} />\n\n        <div className={styles.online}>\n          <OnlineUsers />\n        </div>\n\n        <div className={styles.badge}>\n          <Session />\n        </div>\n      </Container>\n    </header>\n  )\n}\n","import React from 'react'\nimport { Table } from 'react-bootstrap'\n\nexport default () => {\n  return (\n    <div>\n      <h4>Welcome to dotdot</h4>\n      <p>\n        This is a place where you can chat with people whenever you want :)\n        <br />\n        We don't save any messages, so when the last person in a chat\n        disconnects, the chat history is lost.\n      </p>\n      <p>Inactive user accounts are deleted after 2 weeks without chatting.</p>\n\n      <h6>Keep your User</h6>\n      <p>\n        You can set a password to protect your username from being deleted and\n        used by someone else. Simply click on the lock in the top right corner.\n      </p>\n\n      <h6>Private Messages</h6>\n      <p>\n        You can send anyone a private message simply by starting your message\n        with @ and their name. You'll see the text box change to orange and a\n        lock icon appear.\n      </p>\n      <p>\n        Only you and the person you send the message to can see them. If they\n        are offline they won't receive the message\n      </p>\n\n      <h5>Commands</h5>\n      <p>There are some commands that you can use:</p>\n      <Table size=\"sm\" variant=\"dark\">\n        <thead>\n          <tr>\n            <th>Command</th>\n            <th>Example</th>\n            <th>Description</th>\n          </tr>\n        </thead>\n        <tbody>\n          <tr>\n            <td>\n              <code>/help</code>\n            </td>\n            <td>\n              <code>/help</code>\n            </td>\n            <td>It shows this message</td>\n          </tr>\n          <tr>\n            <td>\n              <code>/set color</code>\n            </td>\n            <td>\n              <code>/set color eb0000</code>\n            </td>\n            <td>\n              Change your color, the color needs to be a hex representation\n              (sorry if this sounds confusing, soon there will be an easier way\n              to do this)\n            </td>\n          </tr>\n          <tr>\n            <td>\n              <code>/set icon</code>\n            </td>\n            <td>\n              <code>/set icon smile</code>\n            </td>\n            <td>\n              Change your icon, pick any of the ones from{' '}\n              <a\n                href=\"https://fontawesome.com/icons?d=gallery&s=regular&c=emoji&m=free\"\n                rel=\"noopener noreferrer\"\n                target=\"_blank\"\n              >\n                this list\n              </a>\n            </td>\n          </tr>\n          <tr>\n            <td>\n              <code>/list users</code>\n            </td>\n            <td>\n              <code>/list users</code>\n            </td>\n            <td>Get a list of the users who are currently online</td>\n          </tr>\n        </tbody>\n      </Table>\n    </div>\n  )\n}\n","import React from 'react'\nimport reactStringReplace from 'react-string-replace'\nimport ReactMarkdown from 'react-markdown'\n\nimport { User } from 'store/types'\n\nimport styles from './index.module.scss'\n\nexport const USER_REGEX = new RegExp('@([A-Za-z0-9]+(?:[_][A-Za-z0-9]+)*_?)', 'gmi')\nexport const URL_REGEX = new RegExp(\n  /((?:ftp|http|https):\\/\\/(?:\\w+:{0,1}\\w*@)?(?:\\S+)(?::[0-9]+)?(?:\\/|\\/(?:[\\w#!:.?+=&%@!\\-/]))?)/,\n  'gmi'\n)\n\nexport const parseContent = (message: string, onlineUsers: User[]): React.ReactNodeArray => {\n  return reactStringReplace(\n    message,\n    USER_REGEX,\n    (username, index) => {\n      const style: React.CSSProperties = {}\n      const user = onlineUsers.find(\n        eachUser => eachUser.name === username\n      )\n      if (user) {\n        style.color = user.contrastColor || '#' + user.color\n      }\n      return (\n        <span key={index} className={styles.mention} style={style}>\n          @{username}\n        </span>\n      )\n    }\n  ).map((content, index) => { // parse markdown\n    if (typeof content !== 'string') {\n      return content\n    }\n    return (\n      <ReactMarkdown\n        key={ index }\n        source={ content }\n        unwrapDisallowed={ true }\n        allowedTypes={ ['text', 'link', 'blockquote', 'code', 'strong', 'emphasis', 'delete', 'image', 'inlineCode'] }\n      />\n    )\n  })\n}","import React, { useEffect } from 'react'\n\nimport { fetchResource } from 'util/fetch'\nimport { useImmer } from 'use-immer'\n\nimport styles from './index.module.scss'\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome'\n\ntype Props = {\n  url: string\n}\n\ntype State = {\n  loading: boolean\n  url: string\n  result: {\n    title: string\n    description: string\n    favicon: string | null\n    embed: string | null\n    provider: string | null\n    type: string | null\n    author_name: string | null\n    author_url: string | null\n    images: [{ url: string }] | null\n  } | null\n}\n\nexport default ({ url }: Props) => {\n  const [state, setState] = useImmer<State>({\n    loading: false,\n    url,\n    result: null,\n  })\n\n  useEffect(() => {\n    setState((draft) => {\n      draft.loading = true\n    })\n    fetchResource('/unfurl', 'POST', {\n      url,\n    })\n      .then((data: any) => {\n        setState((draft) => {\n          draft.loading = false\n          draft.result = {\n            title: data.title.replace(/(\\r\\n|\\n|\\r)/gm, ''),\n            description: data.description,\n            favicon: data.favicon,\n            embed: null,\n            provider: null,\n            type: null,\n            author_name: null,\n            author_url: null,\n            images: null,\n          }\n\n          if (data.oEmbed) {\n            draft.result.type = data.oEmbed.type\n            draft.result.provider = data.oEmbed.provider_name\n            draft.result.author_name = data.oEmbed.author_name\n            draft.result.author_url = data.oEmbed.author_url\n          }\n\n          if (data.twitter_card) {\n            draft.url = data.twitter_card.url\n\n            if (\n              data.twitter_card.players &&\n              data.twitter_card.players.length > 0\n            ) {\n              draft.result.embed = data.twitter_card.players[0].url\n\n              // Fallback to site name for type if not video\n              if (draft.result.type !== 'video') {\n                draft.result.type = data.twitter_card.site\n              }\n            }\n          }\n\n          if (data.open_graph) {\n            draft.url = data.open_graph.url\n\n            // Fallback to opengraph type if all fails\n            if (!draft.result.type) {\n              draft.result.type = data.open_graph.type\n            }\n\n            draft.result.images = data.open_graph.images\n          }\n        })\n      })\n      .catch((reason) => {\n        setState((draft) => {\n          draft.loading = true\n          draft.result = null\n        })\n      })\n  }, [url, setState])\n\n  if (state.loading || !state.result) {\n    return null\n  }\n\n  let content = null\n\n  const sizes = {\n    video: {\n      aspect: '16by9',\n      maxWidth: '640px',\n    },\n    '@spotify': {\n      aspect: '1by1',\n      maxWidth: '320px',\n    },\n    SoundCloud: {\n      aspect: null,\n      maxWidth: 'none',\n    },\n  }\n\n  switch (state.result.type) {\n    case 'video':\n    case '@spotify':\n    case 'SoundCloud':\n      if (!state.result.embed) {\n        return null\n      }\n      content = (\n        <div>\n          <div\n            className={\n              sizes[state.result.type].aspect\n                ? `embed-responsive embed-responsive-${\n                    sizes[state.result.type].aspect\n                  }`\n                : undefined\n            }\n            style={{ maxWidth: sizes[state.result.type].maxWidth }}\n          >\n            <iframe\n              className=\"embed-responsive-item\"\n              src={state.result.embed}\n              title={state.result.title}\n              frameBorder=\"0\"\n              allowFullScreen\n              allowTransparency\n              allow=\"encrypted-media\"\n              width=\"100%\"\n              height=\"150\"\n            />\n          </div>\n          <h4>\n            <a\n              href={url}\n              rel=\"noopener noreferrer\"\n              target=\"_blank\"\n              title={state.result.description}\n              className={styles.title}\n            >\n              {state.result.favicon && (\n                <img\n                  className={styles.icon}\n                  src={state.result.favicon}\n                  alt={state.result.title}\n                />\n              )}\n              {state.result.title} <FontAwesomeIcon icon=\"external-link-alt\" />\n            </a>\n            <div className={styles.description}>{state.result.description}</div>\n            {state.result.author_url && state.result.author_name && (\n              <div className={styles.author}>\n                By{' '}\n                <a href={state.result.author_url}>\n                  @{state.result.author_name}\n                </a>\n              </div>\n            )}\n          </h4>\n        </div>\n      )\n      break\n    default:\n      content = (\n        <>\n          <a\n            href={url}\n            rel=\"noopener noreferrer\"\n            target=\"_blank\"\n            title={state.result.description}\n            className={styles.title}\n          >\n            {state.result.favicon && (\n              <img\n                className={styles.icon}\n                src={state.result.favicon}\n                alt={state.result.title}\n              />\n            )}\n            {state.result.title}{' '}\n            <FontAwesomeIcon icon=\"external-link-alt\" />\n          </a>\n          {state.result.description && (\n            <div className={styles.description}>{state.result.description}</div>\n          )}\n\n          <div className={styles.images}>\n            {state.result.images?.map(image => (\n              <img alt={ state.result?.title || image.url } src={image.url} />\n            ))}\n          </div>\n        </>\n      )\n  }\n\n  if (!content) {\n    return null\n  }\n\n  return <blockquote className={styles.embed}>{content}</blockquote>\n}\n","import React, { useMemo } from 'react'\n\nimport { User } from 'store/types'\nimport HelpMessage from '../HelpMessage'\nimport { parseContent, URL_REGEX } from '../lib/parseContent'\nimport Embed from './Embed'\n\nimport styles from './index.module.scss'\n\ntype Props = {\n  content: string\n  isSystem: boolean\n  onlineUsers: User[]\n}\n\nexport default ({ content, isSystem, onlineUsers }: Props) => {\n  let messageContent: React.ReactNodeArray | JSX.Element | string = content\n  const urls: string[] = []\n\n  if (isSystem && content === '/help') {\n    messageContent = <HelpMessage />\n  } else {\n    // find urls for embeds\n    const matches = messageContent.match(URL_REGEX)\n    if (matches) {\n      matches.forEach((url) => {\n        if (!urls.includes(url)) {\n          urls.push(url)\n        }\n      })\n    }\n\n    // replace mentions with colored version\n    messageContent = parseContent(content, onlineUsers)\n  }\n\n  const embeds = useMemo(() => {\n    return urls.map((url) => <Embed key={url} url={url} />)\n  }, [urls])\n\n  return (\n    <div className={styles.messageContent}>\n      {messageContent}\n      {embeds}\n    </div>\n  )\n}\n","import React from 'react';\n\nimport { TimedChange } from 'sections/Chat/Footer/lib/timedDiff';\n\nconst MAX_DELAY = 1500\nconst PLAYBACK_SPEED = 1.25 // 1 is the recorded speed\n\ntype Props = {\n  timers: TimedChange[],\n  message: string,\n}\n\ntype State = {\n  shownText: string\n  currentIndex: number\n  isAnimating: boolean\n}\n\nexport class PlayBackMessage extends React.PureComponent<Props, State> {\n  state: State = {\n    shownText: '',\n    currentIndex: -1,\n    isAnimating: false\n  }\n  private timer: NodeJS.Timeout | null = null\n\n  componentDidMount() {\n    if (this.props.timers.length > 0) {\n      this.nextAnimationStep()\n    }\n  }\n\n  componentDidUpdate(prevProps: Props) {\n    if (prevProps.timers.length === this.props.timers.length ||\n        this.props.timers.length < this.state.currentIndex ||\n        this.state.isAnimating\n    ) {\n      return\n    }\n\n    this.nextAnimationStep()\n  }\n\n  componentWillUnmount() {\n    this.timer && clearTimeout(this.timer)\n  }\n\n  private nextAnimationStep() {\n    const nextIndex = this.state.currentIndex + 1\n\n    if (!this.props.timers[nextIndex]) {\n      // invalid index\n      return\n    }\n\n    this.setState({\n      currentIndex: nextIndex,\n      isAnimating: true\n    }, () => {\n      this.animationStep(nextIndex)\n    })\n  }\n\n  private animationStep(step: number) {\n    const [index, char, timer] = this.props.timers[step]\n\n    this.timer = setTimeout(() => {\n      const nextStepAvailable = step + 1 < this.props.timers.length\n\n      const updatedText = nextStepAvailable ?\n        this.applyChangeToText(this.state.shownText, char, index) :\n        this.props.message\n\n      this.setState({\n        shownText: updatedText,\n        isAnimating: nextStepAvailable\n      }, () => {\n        if (nextStepAvailable) {\n          this.nextAnimationStep()\n        }\n      })\n    }, Math.min(timer, MAX_DELAY) / PLAYBACK_SPEED)\n  }\n\n  private applyChangeToText(text: string, char: string | null, index: number) {\n    if (text.length < 1 && char) {\n      return char\n    }\n    let newText = text\n    const tmp = newText.split('')\n    if (char === null) {\n      tmp.splice(index, 1)\n    } else {\n      tmp.splice(index, 0, char)\n    }\n    newText = tmp.join('')\n    return newText\n  }\n\n  public render() {\n    return (\n      <>\n        { this.state.shownText }\n      </>\n    );\n  }\n}\n\nexport default PlayBackMessage;\n","import React from 'react'\nimport classNames from 'classnames'\nimport { IconProp, IconName } from '@fortawesome/fontawesome-svg-core'\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome'\nimport { OverlayTrigger, Tooltip } from 'react-bootstrap'\n\nimport { User } from 'store/types'\nimport styles from './index.module.scss'\n\ntype Props = {\n  user: User\n  timestamp: Date\n  isDraft: boolean\n  isPrivate: boolean\n  isOnline: boolean\n  isCurrentUser: boolean\n  isReply?: boolean\n}\n\nconst Heading = ({\n  user,\n  timestamp,\n  isDraft,\n  isPrivate,\n  isOnline,\n  isCurrentUser,\n  isReply,\n}: Props) => {\n  const userContrastColor = user.contrastColor || `#${user.color}`\n  const isSystem = user.user_id === 'dotdot'\n\n  let iconName: IconName = 'circle'\n  if (user.icon) {\n    iconName = user.icon\n  } else if (isCurrentUser) {\n    iconName = 'dot-circle'\n  }\n\n  // special icons\n  if (isSystem) {\n    iconName = 'cog'\n  } else if (isDraft) {\n    iconName = 'circle-notch'\n  } else if (isPrivate) {\n    iconName = 'lock'\n  } else if (!isOnline) {\n    iconName = 'meh'\n  }\n\n  let icon: IconProp = iconName\n  if (isCurrentUser && !isPrivate && !isDraft) {\n    icon = ['far', iconName]\n  }\n\n  const UserIcon = () => {\n    const justIcon = (\n      <FontAwesomeIcon icon={icon} spin={!isPrivate && isDraft} />\n    )\n\n    return (\n      <span className={styles.icon} style={{ color: userContrastColor }}>\n        {isPrivate ? (\n          <OverlayTrigger\n            placement=\"right\"\n            overlay={\n              <Tooltip id={`user-${user.user_id}`}>\n                Private message from <b>@{user.name}</b>\n                <br />\n                Only you can see this.\n              </Tooltip>\n            }\n          >\n            {justIcon}\n          </OverlayTrigger>\n        ) : (\n          justIcon\n        )}\n      </span>\n    )\n  }\n\n  const Username = () => (\n    <span style={{ color: userContrastColor }}>{user.name}</span>\n  )\n  const TimeStamp = () => (\n    <span className={classNames(styles.timestamp)}>\n      {timestamp.toLocaleTimeString([], {\n        hour: 'numeric',\n        minute: '2-digit',\n      })}\n    </span>\n  )\n\n  return (\n    <>\n      {!isReply && <UserIcon />}\n\n      <div className={classNames(styles.user)}>\n        <Username />\n        {!isDraft && !isReply && <TimeStamp />}\n      </div>\n    </>\n  )\n}\n\nexport default Heading\n","import React from 'react'\nimport classNames from 'classnames'\n\nimport { Message } from 'store/types'\nimport styles from './index.module.scss'\nimport messageStyles from '../index.module.scss'\nimport MessageComponent from '..'\n\ntype Props = {\n  replyTo: Message | null | undefined\n  replyToId: string | null | undefined\n}\n\nconst Reply = ({ replyTo, replyToId }: Props) => {\n  if (!replyTo || !replyTo.user) {\n    return null\n  }\n\n  const Bar = () => (\n    <span\n      aria-hidden={true}\n      className={styles.bar}\n      style={{\n        background: replyTo.user.contrastColor || `#${replyTo.user.color}`,\n      }}\n    />\n  )\n\n  return (\n    <a\n      href={'#message-' + replyToId}\n      className={classNames(styles.replyBox, {\n        [messageStyles.private]: replyTo.attributes.private,\n      })}\n      title=\"Go to original message\"\n    >\n      <Bar />\n      <div className={styles.scroll}>\n        <MessageComponent reply message={replyTo} />\n      </div>\n    </a>\n  )\n}\n\nexport default Reply\n","import React from 'react'\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome'\nimport { Button } from 'react-bootstrap'\n\nimport styles from './index.module.scss'\n\ntype Props = {\n  onClick: () => void\n}\n\nexport default ({ onClick }: Props) => (\n  <Button\n    className={styles.button}\n    variant=\"link\"\n    onClick={onClick}\n    title=\"Reply to this message\"\n  >\n    <FontAwesomeIcon icon=\"reply\" />\n    <span className={styles.text}>Reply</span>\n  </Button>\n)\n","import React from 'react'\nimport classNames from 'classnames'\n\nimport { Message } from 'store/types'\nimport styles from './index.module.scss'\nimport useGlobalState from 'store/state'\nimport MessageContent from './MessageContent'\nimport PlayBackMessage from './PlayBackMessage'\nimport Heading from './Heading'\nimport Reply from './Reply'\nimport ReplyButton from './ReplyButton'\n\ntype Props = {\n  reply?: boolean\n  message: Message\n  onClick?: (messageId: string) => void\n}\n\nconst MessageComponent = React.memo(({ message, onClick, reply }: Props) => {\n  const { state } = useGlobalState()\n\n  // User data comes from online users if available\n  const userData =\n    state.onlineUsers.find((user) => user.user_id === message.user.user_id) ||\n    message.user\n\n  const isSystem = userData.user_id === 'dotdot'\n  const isUserOnline =\n    isSystem ||\n    state.onlineUsers.findIndex((user) => user.user_id === userData.user_id) >\n      -1\n\n  const isReplyAllowed =\n    !reply && onClick && !isSystem && !message.attributes.draft\n\n  const handleReplyClick = () => {\n    if (!isReplyAllowed || !onClick) {\n      return\n    }\n    onClick(message.uuid)\n  }\n\n  // TODO Move this to a MessageBody component or something like that\n  let messageBody\n  if (reply) {\n    messageBody = message.content.join('. ')\n  } else if (message.attributes.draft && message.timedContent) {\n    messageBody = (\n      <PlayBackMessage\n        timers={message.timedContent}\n        message={message.content[0]}\n      />\n    )\n  } else {\n    messageBody = message.content.map((content) => (\n      <MessageContent\n        content={content}\n        isSystem={isSystem}\n        onlineUsers={state.onlineUsers}\n        key={content}\n      />\n    ))\n  }\n\n  return (\n    <div\n      id={'message-' + message.uuid}\n      className={classNames(styles.message, {\n        [styles.reply]: reply,\n        [styles.system]: isSystem,\n        [styles.offline]: !isUserOnline,\n        [styles.inactive]: !userData.isActive,\n        [styles.draft]: message.attributes.draft,\n        [styles.private]: message.attributes.private,\n      })}\n    >\n      <div className={styles.frame}>\n        {isReplyAllowed && (\n          <div className={styles.actions}>\n            <ReplyButton onClick={handleReplyClick} />\n          </div>\n        )}\n\n        <Heading\n          user={userData}\n          timestamp={message.timestamp}\n          isReply={reply}\n          isOnline={isUserOnline}\n          isDraft={message.attributes.draft}\n          isPrivate={message.attributes.private}\n          isCurrentUser={userData.user_id === state.auth.user?.user_id}\n        />\n      </div>\n\n      {!reply && (\n        <Reply\n          replyTo={message.attributes.replyTo}\n          replyToId={message.attributes.replyToId}\n        />\n      )}\n\n      <div className={classNames(styles.body)}>{messageBody}</div>\n    </div>\n  )\n})\n\nexport default MessageComponent\n","import React from 'react'\nimport smoothscroll from 'smoothscroll-polyfill'\n\nsmoothscroll.polyfill()\n\nconst SCROLL_THRESHOLD = 50\nconst SCROLL_DEBOUNCE_DELAY = 150\n\ntype Props = {\n  onScrollChanged?: (isAtBottom: boolean) => void,\n  boxRef: React.RefObject<HTMLElement | null>,\n  threshold?: number,\n  children?: any,\n}\n\ntype State = {\n  stayAtBottom: boolean\n  height: number\n}\n\n/**\n * Automatic Scroller for any container\n *\n * Algorithm outline:\n *   1. On Mount, scroll to bottom if possible\n *      - scrollTop = scrollHeight\n *      - stayAtBottom = true\n *      - height = scrollHeight\n *   2. On Update (children have changed)\n *      - if scrollHeight != height -> the container is now bigger\n *          - height = scrollHeight\n *          - if stayAtBottom = true -> autoScroll\n *          - if stayAtBottom = false -> nothing (fire onScrollChanged)\n *   3. On Scroll\n *      This event can be triggered by the user scrolling, or by the autoScroll going to the bottom\n *      But all cases are the same:\n *      - if scrollTop < scrollheight -> User scrolled UP\n *          - stayAtBottom = false (no longer stick to the bottom)\n *      - else // this means that the user or the autoScroll scrolled to the bottom\n *          - stayAtBottom = true\n */\nexport default class ScrollBox extends React.PureComponent<Props, State> {\n  private scrollDebounceTimer: any\n  private scrollListenerSetup: boolean = false\n\n  state: State = {\n    stayAtBottom: true,\n    height: 0,\n  }\n\n  componentDidUpdate(prevProps: Props) {\n    if (prevProps.boxRef !== this.props.boxRef ||\n        prevProps.boxRef.current !== this.props.boxRef.current) {\n      this.setupListener(true)\n    }\n    this.setupListener()\n\n    setTimeout(() => {\n      const { boxRef } = this.props\n      if (!boxRef.current) {\n        return;\n      }\n      const height = boxRef.current.scrollHeight;\n      if (height !== this.state.height) {\n        this.setState({\n          height\n        })\n        this.onScroll(true)\n      }\n    })\n  }\n\n  componentDidMount() {\n    window.addEventListener(\"resize\", this.scrollToBottom, true);\n\n    setTimeout(() => {\n      this.scrollToBottom()\n    }, 250)\n  }\n\n  componentWillUnmount() {\n    const { boxRef } = this.props\n\n    if (boxRef && boxRef.current) {\n      boxRef.current.removeEventListener('scroll', this.onScrollDebounced)\n    }\n\n    window.removeEventListener(\"resize\", this.scrollToBottom);\n  }\n\n  /**\n   * Event handler for scroll events on the component\n   * Used to debounce them every SCROLL_DEBOUNCE_DELAY\n   * for performance.\n   * The only point of this is to call props.onScrollChanged\n   * and tell it whether it's at the bottom or not\n   */\n  private onScrollDebounced = () => {\n    clearTimeout(this.scrollDebounceTimer)\n\n    this.scrollDebounceTimer = setTimeout(() => {\n      this.onScroll(false)\n    }, SCROLL_DEBOUNCE_DELAY)\n  }\n\n  /**\n   * onScroll event handler\n   *\n   * It will check if we're at the bottom, and if not and we're meant to scroll to the bottom,\n   * it will go there.\n   */\n  private onScroll = (shouldScroll: boolean) => {\n    const { onScrollChanged, boxRef, threshold } = this.props\n\n    if (!boxRef || !boxRef.current) {\n      return\n    }\n\n    const scrollHeight = boxRef.current.scrollHeight - boxRef.current.offsetHeight\n    const customThreshold = threshold || SCROLL_THRESHOLD\n    const isAtBottom = Math.abs(boxRef.current.scrollTop - scrollHeight) < customThreshold\n\n    if (shouldScroll && this.state.stayAtBottom) {\n      this.scrollToBottom()\n    }\n\n    if (!shouldScroll) {\n      this.setState({\n        stayAtBottom: isAtBottom\n      })\n\n      // Notify of scroll changes\n      onScrollChanged && onScrollChanged(isAtBottom)\n    }\n  }\n\n  /**\n   * Automatically scroll all the way tot he bottom\n   */\n  private scrollToBottom = () => {\n    const { boxRef, onScrollChanged } = this.props\n\n    if (!boxRef || !boxRef.current) {\n      return\n    }\n\n    const scrollHeight = boxRef.current.scrollHeight - boxRef.current.offsetHeight\n    boxRef.current.scroll({\n      top: scrollHeight,\n      left: 0,\n      behavior: 'smooth'\n    });\n\n    this.setState({\n      stayAtBottom: true\n    })\n\n    onScrollChanged && onScrollChanged(true)\n  }\n\n  private setupListener(override: boolean = false) {\n    const { boxRef } = this.props\n\n    if (this.scrollListenerSetup && !override) {\n      return\n    }\n\n    if (boxRef && boxRef.current) {\n      this.scrollListenerSetup = true\n      boxRef.current.addEventListener('scroll', this.onScrollDebounced, true)\n    }\n  }\n\n  render() {\n    return (\n      <>\n        { this.props.children }\n      </>\n    )\n  }\n}","import React, { useEffect, useRef, useCallback } from 'react'\nimport { Container, Button } from 'react-bootstrap'\nimport { useImmer } from 'use-immer'\nimport classNames from 'classnames'\n\nimport MessageComponent from './Message'\n\nimport styles from './index.module.scss'\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome'\nimport ScrollBox from './ScrollBox'\nimport useGlobalState from 'store/state'\n\ntype State = {\n  scrollAtBottom: boolean\n  unseenMessages: boolean // are there new messages below the scroll point?\n}\n\ntype Props = {\n  onMessageClick: (messageId: string) => void\n}\n\nexport default ({ onMessageClick }: Props) => {\n  const { state } = useGlobalState()\n  const [localState, setLocalState] = useImmer<State>({\n    scrollAtBottom: true,\n    unseenMessages: false,\n  })\n\n  const chatAreaRef = useRef<HTMLDivElement>(null)\n\n  const onScrollChanged = useCallback(\n    (isAtBottom: boolean) => {\n      setLocalState((draft) => {\n        draft.scrollAtBottom = isAtBottom\n        if (isAtBottom) {\n          draft.unseenMessages = false\n        }\n      })\n    },\n    [setLocalState]\n  )\n\n  const scrollToBottom = useCallback(() => {\n    if (!chatAreaRef || !chatAreaRef.current) {\n      return\n    }\n    const scrollHeight =\n      chatAreaRef.current.scrollHeight - chatAreaRef.current.offsetHeight\n    chatAreaRef.current.scroll({\n      top: scrollHeight,\n      left: 0,\n      behavior: 'smooth',\n    })\n\n    setLocalState((draft) => {\n      draft.scrollAtBottom = true\n      draft.unseenMessages = false\n    })\n  }, [setLocalState])\n\n  useEffect(() => {\n    setLocalState((draft) => {\n      draft.unseenMessages = !draft.scrollAtBottom\n    })\n  }, [state.messages, setLocalState])\n\n  return (\n    <div className={styles.messages}>\n      {localState.unseenMessages && (\n        <div className={classNames(styles.unseen)}>\n          <Container className={styles.unseenContainer}>\n            <Button variant=\"secondary\" size=\"sm\" onClick={scrollToBottom}>\n              <FontAwesomeIcon icon=\"arrow-alt-circle-down\" /> New messages\n            </Button>\n          </Container>\n        </div>\n      )}\n      <div className={classNames(styles.messageScroll)} ref={chatAreaRef}>\n        <div className={classNames('container', styles.messagesContainer)}>\n          <ScrollBox boxRef={chatAreaRef} onScrollChanged={onScrollChanged}>\n            {state.messages.map((eachMessage) => (\n              <MessageComponent\n                key={eachMessage.uuid}\n                onClick={onMessageClick}\n                message={eachMessage}\n              />\n            ))}\n          </ScrollBox>\n        </div>\n      </div>\n    </div>\n  )\n}\n","/**\n * Get the difference between two date objects in ms\n */\nexport const dateDiff = (t1: Date, t2: Date = new Date()) => {\n  return t2.getTime() - t1.getTime();\n}","import React from 'react'\nimport { Button } from 'react-bootstrap'\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome'\n\nimport MessageComponent from '../../Messages/Message'\nimport { Message } from 'store/types'\n\nimport styles from './index.module.scss'\n\ntype Props = {\n  replyTo: Message\n  onCancelReply: () => void\n}\n\nexport default ({ replyTo, onCancelReply }: Props) => {\n  return (\n    <div\n      className={styles.reply}\n      style={{\n        borderLeftColor: replyTo.user.contrastColor || `#${replyTo.user.color}`,\n      }}\n    >\n      <div className={styles.actions}>\n        <Button variant=\"link\" onClick={onCancelReply}>\n          <FontAwesomeIcon icon=\"times\" />\n        </Button>\n      </div>\n      <MessageComponent reply message={replyTo} />\n    </div>\n  )\n}\n","import React from 'react'\nimport { Form } from 'react-bootstrap'\nimport classNames from 'classnames'\n\nimport styles from './index.module.scss'\nimport useGlobalState from 'store/state'\n\ntype Props = {\n  value: any\n  kind: 'private' | 'command' | false\n  inputRef: React.Ref<any>\n  onChange: (e: React.ChangeEvent<any>) => void\n  children: React.ReactNode\n}\n\nexport default ({ value, kind, inputRef, onChange, children }: Props) => {\n  const { state, dispatch } = useGlobalState()\n\n  const handleFocus = (focus: boolean) => () => {\n    dispatch({\n      type: 'chat_focus',\n      payload: focus,\n    })\n  }\n\n  return (\n    <div\n      className={classNames(styles.field, {\n        [styles.focused]: state.chat.focused,\n        [styles.private]: kind === 'private',\n        [styles.command]: kind === 'command',\n      })}\n    >\n      <Form.Control\n        ref={inputRef}\n        className={styles.inputArea}\n        onChange={onChange}\n        onFocus={handleFocus(true)}\n        onBlur={handleFocus(false)}\n        value={value}\n        autoFocus\n        as=\"input\"\n        type=\"text\"\n        autoComplete=\"off\"\n        placeholder=\"Type a message...\"\n      />\n      <div className={styles.actions}>{children}</div>\n    </div>\n  )\n}\n","import React from 'react'\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome'\nimport { Button } from 'react-bootstrap'\n\nimport styles from './index.module.scss'\n\ntype Props = {\n  disabled: boolean\n}\n\nexport default ({ disabled }: Props) => (\n  <Button className={styles.button} type=\"submit\" disabled={disabled}>\n    <FontAwesomeIcon icon=\"paper-plane\" />\n  </Button>\n)\n","import React from 'react'\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome'\nimport { IconProp } from '@fortawesome/fontawesome-svg-core'\nimport classNames from 'classnames'\n\nimport styles from './index.module.scss'\n\ntype Props = {\n  onHelp: () => void\n  kind: 'private' | 'command' | false\n}\n\nexport default ({ onHelp, kind }: Props) => {\n  let icon: IconProp = 'question-circle'\n  if (kind === 'command') {\n    icon = 'code'\n  } else if (kind === 'private') {\n    icon = 'eye-slash'\n  }\n\n  const handleClick = () => {\n    if (icon !== 'question-circle') {\n      return\n    }\n    onHelp()\n  }\n\n  return (\n    <div\n      className={classNames(styles.textIcon, {\n        [styles.interactive]: kind === false,\n        [styles.private]: kind === 'private',\n        [styles.command]: kind === 'command',\n      })}\n      onClick={handleClick}\n    >\n      <FontAwesomeIcon icon={icon} />\n    </div>\n  )\n}\n","import React, { useContext, useRef } from 'react'\nimport { Form, Container } from 'react-bootstrap'\nimport { useImmer } from 'use-immer'\n\nimport { SocketContext } from 'util/socketProvider'\nimport { getMessageKind, getMessagePmTo } from 'lib/messageParse'\nimport useGlobalState from 'store/state'\nimport { EVENTS, Message, OutgoingMessage } from 'store/types'\n\nimport { timedDiff, TimedChange } from './lib/timedDiff'\nimport Reply from './Reply'\nimport Field from './Field'\nimport Submit from './Submit'\nimport TextIcon from './TextIcon'\n\nimport styles from './index.module.scss'\n\ntype State = {\n  message: string\n  timedMessage: TimedChange[]\n  lastKeyStroke: Date | null\n  kind: 'private' | 'command' | false\n  to: string | null\n}\n\ntype Props = {\n  replyTo?: Message | null\n  onCancelReply: () => void\n}\n\nexport default ({ replyTo, onCancelReply }: Props) => {\n  const { state, dispatch } = useGlobalState()\n\n  const [localState, setState] = useImmer<State>({\n    message: '',\n    timedMessage: [],\n    lastKeyStroke: null,\n    kind: false,\n    to: null,\n  })\n  const draftTimer = useRef<any>(null)\n  const inputRef = useRef<any>(null)\n\n  const { socket } = useContext(SocketContext)\n\n  const askForHelp = () => {\n    dispatch({\n      type: 'system_message',\n      payload: '/help',\n    })\n  }\n\n  const handleSubmit = (e: React.ChangeEvent<any>) => {\n    e.preventDefault()\n\n    if (localState.message.length < 1 || localState.message.trim().length < 1) {\n      return\n    }\n\n    sendMessage(localState.message)\n\n    setState((draft) => {\n      draft.message = ''\n      draft.timedMessage = []\n      draft.lastKeyStroke = null\n      draft.kind = false\n    })\n\n    // refocus the input\n    setTimeout(() => {\n      if (inputRef.current) {\n        inputRef.current.focus()\n      }\n    })\n\n    onCancelReply && onCancelReply()\n  }\n\n  const sendMessage = (message: string, draft: boolean = false) => {\n    if (!draft && (message.length < 1 || message.trim().length < 1)) {\n      return\n    }\n\n    if (message === '/help') {\n      return askForHelp()\n    }\n\n    let type = EVENTS.MESSAGE\n    if (localState.kind === 'command') {\n      type = EVENTS.COMMAND\n    }\n\n    const payload: OutgoingMessage = {\n      content: message,\n      attributes: {\n        draft,\n        private: localState.kind === 'private',\n        to: localState.to,\n        replyToId: replyTo ? replyTo.uuid : null,\n      },\n    }\n\n    if (draft) {\n      payload.timedContent = localState.timedMessage\n    }\n\n    socket?.emit(type, payload)\n  }\n\n  const onType = (e: React.ChangeEvent<any>) => {\n    e.preventDefault()\n\n    clearTimeout(draftTimer.current)\n\n    const value: string = e.currentTarget.value\n    const kind = getMessageKind(value)\n\n    // special messages\n    setState((draft) => {\n      // Timed messages\n      const timedMessage = timedDiff(value, draft.message, draft.lastKeyStroke)\n      if (timedMessage) {\n        draft.timedMessage.push(...timedMessage)\n      } else if (value.length > 0) {\n        draft.timedMessage = [[0, value, 0]]\n      } else {\n        draft.timedMessage = []\n      }\n\n      draft.message = value\n      draft.kind = kind\n      draft.to = kind === 'private' ? getMessagePmTo(value) : null\n      draft.lastKeyStroke = new Date()\n    })\n\n    // Avoid sending drafts for commands or PMs\n    if (kind) {\n      return\n    }\n\n    if (state.draftTimer > 0) {\n      draftTimer.current = setTimeout(() => {\n        sendMessage(value, true)\n      }, state.draftTimer)\n    }\n  }\n\n  const FieldActions = () => (\n    <>\n      <TextIcon kind={localState.kind} onHelp={askForHelp} />\n      <Submit disabled={!state.chat.focused} />\n    </>\n  )\n\n  return (\n    <div className={styles.footer}>\n      <Container className={styles.container}>\n        {replyTo && <Reply replyTo={replyTo} onCancelReply={onCancelReply} />}\n        <Form noValidate onSubmit={handleSubmit}>\n          <Field\n            inputRef={inputRef}\n            kind={localState.kind}\n            value={localState.message}\n            onChange={onType}\n          >\n            <FieldActions />\n          </Field>\n        </Form>\n      </Container>\n    </div>\n  )\n}\n","import { VALID_USERNAME } from '../constants'\n\n// Detects actions based on message string on input\n\nconst isCommand = (val: string) => val[0] === '/'\nconst isPm = (val: string) => val[0] === '@'\n\nexport const getMessageKind = (val: string) => {\n  if (isCommand(val)) return 'command'\n  if (isPm(val)) return 'private'\n  return false\n}\n\nexport const getMessagePmTo = (val: string) => {\n  const words = val.split(' ')\n\n  if (\n    words.length > 0 &&\n    words[0][0] === '@' &&\n    VALID_USERNAME.test(words[0].substr(1))\n  ) {\n    return words[0].substr(1)\n  }\n\n  return null\n}\n","import diff from 'fast-diff'\n\nimport { dateDiff } from \"lib/dateDiff\"\n\nexport type TimedChange = [number, string | null, number]\n\nexport function timedDiff(currentValue: string, previousValue: string, lastKeyStroke: Date | null): TimedChange[] | null {\n  const diffs = diff(previousValue, currentValue)\n\n  let currentIndex = 0;\n  const timedMessages: TimedChange[] = [];\n  const timeDiff = lastKeyStroke ? dateDiff(lastKeyStroke) : 0;\n\n  for (const eachDiff of diffs) {\n    if (eachDiff[0] === diff.EQUAL) {\n      currentIndex += eachDiff[1].length\n      continue\n    }\n    if (eachDiff[0] === diff.DELETE && eachDiff[1].length > 1) {\n      // at least for now, deleting more than one character will\n      // just reset the animation to simplify the process\n      return null\n    }\n    timedMessages.push([\n      currentIndex,\n      eachDiff[0] === diff.INSERT ? eachDiff[1] : null,\n      timeDiff\n    ])\n  }\n\n  return timedMessages\n}","import React, { useEffect, useCallback } from 'react'\nimport classNames from 'classnames'\nimport smoothscroll from 'smoothscroll-polyfill'\n\nimport { useGlobalState } from 'store/state'\nimport Loader from 'components/Loader'\n\nimport styles from './index.module.scss'\nimport Header from './Header'\nimport Messages from './Messages'\nimport Footer from './Footer'\nimport { useImmer } from 'use-immer'\nimport { Message } from 'store/types'\n\n// fix for browser with no smooth scrolling\nsmoothscroll.polyfill()\n\ntype State = {\n  scrollingWhileFocused: boolean\n  replyTo: Message | null\n}\n\nexport default () => {\n  const { state } = useGlobalState()\n  const [localState, setState] = useImmer<State>({\n    scrollingWhileFocused: false,\n    replyTo: null,\n  })\n\n  const onMessageClick = useCallback(\n    (messageId: string) => {\n      setState((draft) => {\n        const messageReply =\n          state.messages.find(\n            (eachMessage) =>\n              eachMessage.uuid === messageId\n          ) || null\n        draft.replyTo = messageReply\n      })\n    },\n    [state.messages, setState]\n  )\n\n  const cancelReply = useCallback(() => {\n    setState((draft) => {\n      draft.replyTo = null\n    })\n  }, [setState])\n\n  // On window scroll\n  const setHeaderPosition = useCallback(() => {\n    setState((draft) => {\n      if (state.chat.focused) {\n        draft.scrollingWhileFocused = true\n      }\n    })\n    // eslint-disable-next-line\n  }, [setState])\n\n  useEffect(() => {\n    window.addEventListener('scroll', setHeaderPosition, true)\n\n    return () => {\n      window.removeEventListener('scroll', setHeaderPosition)\n    }\n  }, [setHeaderPosition])\n\n  useEffect(() => {\n    if (state.chat.focused) {\n      setHeaderPosition()\n    } else {\n      setState((draft) => {\n        draft.scrollingWhileFocused = false\n      })\n    }\n  }, [setState, setHeaderPosition, state.chat.focused])\n\n  if (!state.socket.connected) {\n    return <Loader />\n  }\n\n  return (\n    <div\n      className={classNames(styles.chat, {\n        [styles.scrollingChat]: localState.scrollingWhileFocused,\n      })}\n    >\n      <Header scrollingWhileFocused={localState.scrollingWhileFocused} />\n\n      <Messages onMessageClick={onMessageClick} />\n\n      <Footer replyTo={localState.replyTo} onCancelReply={cancelReply} />\n    </div>\n  )\n}\n","import React from 'react'\n\nimport Loader from 'components/Loader'\n\nexport default () => {\n  return (\n    <>\n      <Loader />\n    </>\n  )\n}\n","import React from 'react'\nimport { Route, Redirect } from 'react-router-dom'\nimport { useGlobalState } from 'store/state'\n\nimport Loading from 'sections/loading'\n\ntype Props = {\n  path: string\n  exact?: boolean\n  component?: React.ComponentType<any>\n}\n\n/**\n * This Route only allows browsing into if the user IS logged in\n */\nexport default (props: Props) => {\n  const { state } = useGlobalState()\n  if (!state.auth.checked) {\n    return <Loading />\n  }\n\n  if (!state.auth.loggedIn) {\n    return <Redirect to=\"/login\" />\n  }\n\n  return (\n    <Route path={props.path} exact={props.exact} component={props.component} />\n  )\n}\n","import React from 'react'\nimport { Route, Redirect } from 'react-router-dom'\nimport { useGlobalState } from 'store/state'\n\nimport Loading from 'sections/loading'\n\ntype Props = {\n  path: string\n  exact?: boolean\n  component?: React.ComponentType<any>\n}\n\n/**\n * This Route only allows browsing into if the user is NOT logged in\n */\nexport default (props: Props) => {\n  const { state } = useGlobalState()\n  if (!state.auth.checked) {\n    return <Loading />\n  }\n\n  if (state.auth.loggedIn) {\n    return <Redirect to=\"/\" />\n  }\n\n  return (\n    <Route path={props.path} exact={props.exact} component={props.component} />\n  )\n}\n","import React from 'react'\n\nimport { useGlobalState } from 'store/state'\nimport styles from './index.module.scss'\n\nexport default () => {\n  const { state } = useGlobalState()\n\n  if (!state.offline && !state.error) {\n    return null\n  }\n\n  let error = state.error\n  if (Array.isArray(error)) {\n    error = error.join('. ')\n  }\n  if (typeof error !== 'string') {\n    error = String(error)\n  }\n\n  if (state.error) {\n    return <div className={styles.offline}>Error: {error}</div>\n  }\n\n  return (\n    <div className={styles.offline}>\n      One of us is offline! Please try again later\n    </div>\n  )\n}\n","import React, { useRef } from 'react'\nimport { Form, Container, Button, Row, Col, InputGroup } from 'react-bootstrap'\nimport { useImmer } from 'use-immer'\nimport classNames from 'classnames'\nimport HCaptcha from 'react-hcaptcha'\nimport ReCaptcha from 'react-google-recaptcha'\n\nimport { useGlobalState } from 'store/state'\nimport { fetchResource } from 'util/fetch'\n\nimport styles from './index.module.scss'\nimport { AuthData } from 'store/types'\nimport { CAPTCHA_KEY, CAPTCHA_PROVIDER } from '../../constants'\nimport Logo from 'components/Logo'\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome'\n\ntype State = {\n  username: string\n  password: string\n  verified: boolean\n  hasPassword: boolean\n  loading: boolean\n}\n\nexport default () => {\n  const { dispatch } = useGlobalState()\n  const [localState, setState] = useImmer<State>({\n    username: '',\n    password: '',\n    verified: false,\n    hasPassword: false,\n    loading: false,\n  })\n\n  const captchaRef = useRef<any>(null)\n\n  const handleSubmit = (e: React.ChangeEvent<any>) => {\n    e.preventDefault()\n    if (localState.verified) {\n      oncaptchaChange('verified')\n      return\n    }\n    captchaRef.current.execute()\n  }\n\n  const reset = () => {\n    console.log('reset')\n    setState((draft) => {\n      draft.loading = false\n      draft.hasPassword = false\n    })\n  }\n\n  const oncaptchaChange = (token: string | null) => {\n    if (!token || localState.loading) {\n      return\n    }\n\n    setState((draft) => {\n      draft.loading = true\n    })\n\n    const body = {\n      username: localState.username,\n      password: localState.password,\n      captchaToken: token,\n    }\n    fetchResource('/auth', 'POST', body)\n      .then((data: AuthData) => {\n        if (captchaRef.current.resetCaptcha) {\n          captchaRef.current.resetCaptcha()\n        }\n\n        if (!data || !data.user.user_id) {\n          console.warn('Invalid user object')\n          dispatch({\n            type: 'login',\n            payload: null,\n          })\n          return\n        }\n\n        dispatch({\n          type: 'login',\n          payload: data,\n        })\n      })\n      .catch((reason) => {\n        if (reason.status !== 400) {\n          // username requires password\n          dispatch({\n            type: 'error',\n            payload: reason.errors.join(', '),\n          })\n        }\n\n        if (captchaRef.current.resetCaptcha) {\n          captchaRef.current.resetCaptcha()\n        }\n\n        setState((draft) => {\n          draft.loading = false\n          draft.verified = (reason.data && reason.data.verified) || false\n          if (reason.status === 400) {\n            draft.hasPassword = true\n          }\n        })\n      })\n  }\n\n  let theme: 'light' | 'dark' = 'light'\n  if (\n    window.matchMedia &&\n    window.matchMedia('(prefers-color-scheme: dark)').matches\n  ) {\n    theme = 'dark'\n  }\n\n  return (\n    <div className={styles.all}>\n      <Container className={styles.login}>\n        <div className={styles.title}>\n          {localState.hasPassword\n            ? \"I've seen you before, welcome back!\"\n            : 'How should we call you?'}\n        </div>\n        <Form noValidate onSubmit={handleSubmit}>\n          <Form.Group controlId=\"loginForm.username\">\n            <div className={styles.singleLineForm}>\n              <InputGroup\n                bsPrefix={classNames(styles.singleLineFormPiece, 'input-group')}\n              >\n                <InputGroup.Prepend>\n                  <InputGroup.Text id=\"basic-addon1\" className={styles.at}>\n                    @\n                  </InputGroup.Text>\n                </InputGroup.Prepend>\n                <Form.Control\n                  as=\"input\"\n                  type=\"text\"\n                  autoComplete=\"username\"\n                  placeholder=\"Username...\"\n                  disabled={localState.loading}\n                  autoFocus\n                  minLength={1}\n                  maxLength={20}\n                  onChange={(e) => {\n                    const value = e.currentTarget.value\n                    setState((draft) => {\n                      draft.username = value\n                    })\n                  }}\n                  value={localState.username}\n                />\n              </InputGroup>\n              {localState.hasPassword && (\n                <Form.Control\n                  as=\"input\"\n                  className={styles.singleLineFormPiece}\n                  type=\"password\"\n                  placeholder=\"Password...\"\n                  autoComplete=\"current-password\"\n                  disabled={localState.loading}\n                  autoFocus\n                  onChange={(e) => {\n                    const value = e.currentTarget.value\n                    setState((draft) => {\n                      draft.password = value\n                    })\n                  }}\n                  value={localState.password}\n                />\n              )}\n              <Button\n                className={styles.singleLineFormPiece}\n                type=\"submit\"\n                size=\"sm\"\n              >\n                Enter\n              </Button>\n            </div>\n\n            <div className={styles.subtitle}>\n              {localState.hasPassword && (\n                <Button variant=\"link\" onClick={reset}>\n                  Not you?\n                </Button>\n              )}\n            </div>\n\n            {CAPTCHA_PROVIDER === 'recaptcha' && (\n              <ReCaptcha\n                ref={captchaRef}\n                size=\"invisible\"\n                theme={theme}\n                sitekey={CAPTCHA_KEY}\n                onChange={oncaptchaChange}\n              />\n            )}\n            {CAPTCHA_PROVIDER === 'hcaptcha' && (\n              <HCaptcha\n                ref={captchaRef}\n                size=\"invisible\"\n                theme={theme}\n                sitekey={CAPTCHA_KEY}\n                onVerify={oncaptchaChange}\n              />\n            )}\n          </Form.Group>\n        </Form>\n      </Container>\n\n      <Container>\n        <Row>\n          <Logo className={styles.logo} />\n        </Row>\n        <Row>\n          <p className={styles.description}>\n            A place where you can talk to people\n          </p>\n        </Row>\n        <Row>\n          <Col sm={12} md={true}>\n            <h5 className={classNames(styles.ksp, 'red-text')}>\n              Limited capacity\n            </h5>\n            <p className={styles.copy}>\n              Never more than 10 people at once. Big live chats make it\n              impossible to have a conversation or keep track of one. Here we\n              break it down so people can engage.\n            </p>\n          </Col>\n          <Col sm={12} md={true}>\n            <h5 className={classNames(styles.ksp, 'red-text')}>\n              Message streaming\n            </h5>\n            <p className={styles.copy}>\n              As you type, your message will be shared live with the room, and\n              so will other dot's messages. This makes for a more engaging, real\n              experience.\n            </p>\n          </Col>\n          <Col sm={12} md={true}>\n            <h5 className={classNames(styles.ksp, 'red-text')}>\n              Absolutely private\n            </h5>\n            <p className={styles.copy}>\n              No private data is stored, period. We don’t relate your IP to your\n              user, so we could never track you.\n            </p>\n          </Col>\n        </Row>\n        <Row>\n          <Col>\n            <p className={styles.github}>\n              <a\n                href=\"https://github.com/dotdot-im\"\n                target=\"_blank\"\n                rel=\"external noopener noreferrer\"\n                title=\"View dotdot organisation on GitHub\"\n              >\n                <FontAwesomeIcon icon={['fab', 'github']} /> dotdot-im\n              </a>\n            </p>\n          </Col>\n        </Row>\n      </Container>\n    </div>\n  )\n}\n","import { Action, AuthData } from 'store/types'\n\nimport { fetchResource } from './fetch'\n\nconst OFFLINE_RETRY_DELAY = 2000\n\nexport const checkAuth = (dispatch: React.Dispatch<Action>) => {\n  fetchResource('/auth', 'GET')\n    .then((data: AuthData) => {\n      if (!data || !data.user.user_id) {\n        console.warn('Invalid user object')\n        dispatch({\n          type: 'login',\n          payload: null,\n        })\n        return\n      }\n\n      dispatch({\n        type: 'login',\n        payload: data,\n      })\n    })\n    .catch((reason) => {\n      if (reason.message === 'Network Error' || reason.message === 'offline') {\n        dispatch({\n          type: 'offline',\n          payload: null,\n        })\n\n        // try again\n        setTimeout(() => {\n          checkAuth(dispatch)\n        }, OFFLINE_RETRY_DELAY)\n      } else {\n        if (reason.status !== 401) {\n          dispatch({\n            type: 'error',\n            payload: reason.errors.join(', '),\n          })\n        }\n\n        dispatch({\n          type: 'login',\n          payload: null,\n        })\n      }\n    })\n}\n\nexport default checkAuth\n","import React, { useEffect } from 'react'\nimport { Switch } from 'react-router-dom'\n\nimport Chat from 'sections/Chat'\nimport AuthenticatedRoute from 'util/AuthenticatedRoute'\nimport UnauthenticatedRoute from 'util/UnauthenticatedRoute'\nimport OfflineCheck from 'components/OfflineCheck'\nimport Login from 'sections/Login'\nimport useGlobalState from 'store/state'\nimport checkAuth from 'util/checkAuth'\nimport Admin from 'sections/Admin'\n\nexport default () => {\n  const { state, dispatch } = useGlobalState()\n\n  // Check authentication state\n  useEffect(() => {\n    if (!state.auth.checked) {\n      checkAuth(dispatch)\n    }\n  }, [state.auth.checked, dispatch])\n\n  return (\n    <>\n      <OfflineCheck />\n      <Switch>\n        <UnauthenticatedRoute path=\"/login\" component={Login} />\n        <AuthenticatedRoute path=\"/admin\" component={Admin} />\n        <AuthenticatedRoute path=\"/\" component={Chat} />\n      </Switch>\n    </>\n  )\n}\n","import React, { useEffect, useContext, useCallback } from 'react'\nimport { Helmet } from 'react-helmet'\nimport useSound from 'use-sound'\nimport { useImmer } from 'use-immer'\n\nimport { SocketContext } from 'util/socketProvider'\nimport { Message } from 'store/types'\nimport useGlobalState from 'store/state'\nimport newMessageSound from 'assets/sounds/newMessage.mp3'\nimport { dateDiff } from 'lib/dateDiff'\n\nconst TIME_BETWEEN_SOUND = 5 * 1000 // ms\nconst NOTIFICATION_VOLUME = 0.5 // 0-1\n\ntype State = {\n  lastSound: Date | null,\n  windowFocused: boolean,\n  titleNotification: boolean,\n}\n\nexport default () => {\n  const { state } = useGlobalState();\n  const [ localState, setState ] = useImmer<State>({\n    lastSound: new Date(),\n    windowFocused: true,\n    titleNotification: false,\n  })\n\n  const { socket } = useContext(SocketContext)\n  const [ play ] = useSound(newMessageSound, {\n    interrupt: true,\n    volume: NOTIFICATION_VOLUME,\n  });\n\n  const onMessage = useCallback((user_id: string) => (msg: Message) => {\n    if (msg.attributes.draft || user_id === msg.user.user_id) {\n      return\n    }\n\n    setState(draft => {\n      if (!draft.windowFocused) {\n        draft.titleNotification = true;\n\n        if (!draft.lastSound || dateDiff(draft.lastSound) > TIME_BETWEEN_SOUND) {\n          draft.lastSound = new Date()\n          play({})\n        }\n      }\n    })\n  }, [setState, play])\n\n  const onFocus = useCallback(() => {\n    setState(draft => {\n      draft.titleNotification = false\n      draft.windowFocused = true\n    })\n  }, [setState])\n\n  const onBlur = useCallback(() => {\n    setState(draft => {\n      draft.windowFocused = false\n    })\n  }, [setState])\n\n  const user_id = state.auth.user ? state.auth.user.user_id : null\n\n  useEffect(() => {\n    if (!socket || !user_id) {\n      return\n    }\n    socket.on('message', onMessage(user_id))\n  }, [socket, onMessage, user_id])\n\n  useEffect(() => {\n    window.addEventListener('focus', onFocus)\n    window.addEventListener('blur', onBlur)\n\n    return () => {\n      window.removeEventListener('focus', onFocus)\n      window.removeEventListener('blur', onBlur)\n    }\n  }, [onFocus, onBlur])\n\n  return (\n    <Helmet>\n      <title>{localState.titleNotification ? '•• dotdot' : 'dotdot'}</title>\n    </Helmet>\n  )\n}\n","import { library } from '@fortawesome/fontawesome-svg-core'\n\n/**\n * Icon Preloading\n * This is done so that only the icons that we need are loaded from FontAwesome\n */\n\n// Icons available in two styles, regular and solid\n// solid tends to have all free icons, while some regular ones are PRO only\nimport {\n  faLock,\n  faLockOpen,\n  faCircle,\n  faDotCircle,\n  faCircleNotch,\n  faCode,\n  faCog,\n  faArrowAltCircleDown,\n  faMeh,\n  faAngry,\n  faDizzy,\n  faFlushed,\n  faFrown,\n  faFrownOpen,\n  faGrimace,\n  faGrin,\n  faGrinAlt,\n  faGrinBeam,\n  faGrinBeamSweat,\n  faGrinHearts,\n  faGrinSquint,\n  faGrinSquintTears,\n  faGrinStars,\n  faGrinTears,\n  faGrinTongue,\n  faGrinTongueSquint,\n  faGrinTongueWink,\n  faGrinWink,\n  faKiss,\n  faKissBeam,\n  faKissWinkHeart,\n  faLaugh,\n  faLaughBeam,\n  faLaughSquint,\n  faLaughWink,\n  faMehBlank,\n  faMehRollingEyes,\n  faSadCry,\n  faSadTear,\n  faSmile,\n  faSmileBeam,\n  faSmileWink,\n  faSurprise,\n  faTired,\n  faShieldAlt,\n  faQuestionCircle,\n  faPaperPlane,\n  faTimes,\n  faReply,\n  faExternalLinkAlt,\n  faEyeSlash,\n  faRobot,\n} from '@fortawesome/free-solid-svg-icons'\n\nimport {\n  faDotCircle as farDotCircle,\n  faMeh as farMeh,\n  faAngry as farAngry,\n  faDizzy as farDizzy,\n  faFlushed as farFlushed,\n  faFrown as farFrown,\n  faFrownOpen as farFrownOpen,\n  faGrimace as farGrimace,\n  faGrin as farGrin,\n  faGrinAlt as farGrinAlt,\n  faGrinBeam as farGrinBeam,\n  faGrinBeamSweat as farGrinBeamSweat,\n  faGrinHearts as farGrinHearts,\n  faGrinSquint as farGrinSquint,\n  faGrinSquintTears as farGrinSquintTears,\n  faGrinStars as farGrinStars,\n  faGrinTears as farGrinTears,\n  faGrinTongue as farGrinTongue,\n  faGrinTongueSquint as farGrinTongueSquint,\n  faGrinTongueWink as farGrinTongueWink,\n  faGrinWink as farGrinWink,\n  faKiss as farKiss,\n  faKissBeam as farKissBeam,\n  faKissWinkHeart as farKissWinkHeart,\n  faLaugh as farLaugh,\n  faLaughBeam as farLaughBeam,\n  faLaughSquint as farLaughSquint,\n  faLaughWink as farLaughWink,\n  faMehBlank as farMehBlank,\n  faMehRollingEyes as farMehRollingEyes,\n  faSadCry as farSadCry,\n  faSadTear as farSadTear,\n  faSmile as farSmile,\n  faSmileBeam as farSmileBeam,\n  faSmileWink as farSmileWink,\n  faSurprise as farSurprise,\n  faTired as farTired,\n} from '@fortawesome/free-regular-svg-icons'\n\nimport {\n  faGithub\n} from '@fortawesome/free-brands-svg-icons'\n\n/**\n * All icons that will be used in this app need to be preloaded here\n */\nlibrary.add(\n  faLock,\n  faLockOpen,\n  faEyeSlash,\n  faCircle,\n  faDotCircle,\n  farDotCircle,\n  faCircleNotch,\n  faCode,\n  faCog,\n  faArrowAltCircleDown,\n  faMeh,\n  farMeh,\n  faAngry,\n  faDizzy,\n  faFlushed,\n  faFrown,\n  faFrownOpen,\n  faGrimace,\n  faGrin,\n  faGrinAlt,\n  faGrinBeam,\n  faGrinBeamSweat,\n  faGrinHearts,\n  faGrinSquint,\n  faGrinSquintTears,\n  faGrinStars,\n  faGrinTears,\n  faGrinTongue,\n  faGrinTongueSquint,\n  faGrinTongueWink,\n  faGrinWink,\n  faKiss,\n  faKissBeam,\n  faKissWinkHeart,\n  faLaugh,\n  faLaughBeam,\n  faLaughSquint,\n  faLaughWink,\n  faMehBlank,\n  faMehRollingEyes,\n  faSadCry,\n  faSadTear,\n  faSmile,\n  faSmileBeam,\n  faSmileWink,\n  faSurprise,\n  faTired,\n  farAngry,\n  farDizzy,\n  farFlushed,\n  farFrown,\n  farFrownOpen,\n  farGrimace,\n  farGrin,\n  farGrinAlt,\n  farGrinBeam,\n  farGrinBeamSweat,\n  farGrinHearts,\n  farGrinSquint,\n  farGrinSquintTears,\n  farGrinStars,\n  farGrinTears,\n  farGrinTongue,\n  farGrinTongueSquint,\n  farGrinTongueWink,\n  farGrinWink,\n  farKiss,\n  farKissBeam,\n  farKissWinkHeart,\n  farLaugh,\n  farLaughBeam,\n  farLaughSquint,\n  farLaughWink,\n  farMehBlank,\n  farMehRollingEyes,\n  farSadCry,\n  farSadTear,\n  farSmile,\n  farSmileBeam,\n  farSmileWink,\n  farSurprise,\n  farTired,\n  faShieldAlt,\n  faQuestionCircle,\n  faPaperPlane,\n  faTimes,\n  faReply,\n  faExternalLinkAlt,\n  faRobot,\n  faGithub,\n)\n","import React from 'react'\nimport ReactDOM from 'react-dom'\nimport { BrowserRouter } from 'react-router-dom'\n\nimport { StateProvider } from 'store/state'\nimport SocketProvider from 'util/socketProvider'\n\nimport Router from './router'\nimport Title from './components/Title'\n\nimport './lib/icons'\nimport 'assets/scss/index.scss'\n\n\nconst app = (\n  <BrowserRouter basename={process.env.REACT_APP_BASEPATH}>\n    <StateProvider>\n      <SocketProvider>\n        <Title />\n        <Router />\n      </SocketProvider>\n    </StateProvider>\n  </BrowserRouter>\n)\n\nReactDOM.render(app, document.getElementById('root'))\n","// extracted by mini-css-extract-plugin\nmodule.exports = {\"header\":\"Header_header__2XEwx\",\"container\":\"Header_container__1A72e\",\"logo\":\"Header_logo__1GzGV\",\"online\":\"Header_online__2vz5R\",\"badge\":\"Header_badge__3OtLN\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"badge\":\"UserBadge_badge__28gDi\",\"lock\":\"UserBadge_lock__EV7LR\",\"closed\":\"UserBadge_closed__3uZeG\",\"pulse\":\"UserBadge_pulse__3c_w7\",\"dot\":\"UserBadge_dot__1T6bu\",\"name\":\"UserBadge_name__jOOgp\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"messages\":\"Messages_messages__tCmp1\",\"messageScroll\":\"Messages_messageScroll__CCnSp\",\"messagesContainer\":\"Messages_messagesContainer__2XvrE\",\"unseen\":\"Messages_unseen__gVw6f\",\"unseenContainer\":\"Messages_unseenContainer__3haBw\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"dashboardWidget\":\"Widget_dashboardWidget__Z_mwK\",\"title\":\"Widget_title__2QBZt\",\"content\":\"Widget_content__1BMNx\",\"icon\":\"Widget_icon__3cYOg\",\"blue\":\"Widget_blue__1DB9R\",\"green\":\"Widget_green__2mXfC\",\"orange\":\"Widget_orange__X3jtY\",\"history\":\"Widget_history__1eQoj\",\"change\":\"Widget_change__36iJl\",\"text-muted\":\"Widget_text-muted__1SkGI\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"logo\":\"LogoAnimation_logo__cXB1h\",\"svgFilter\":\"LogoAnimation_svgFilter__DGLai\",\"blob\":\"LogoAnimation_blob__1-tkV\",\"blob-first\":\"LogoAnimation_blob-first__kGvvT\",\"blob-second\":\"LogoAnimation_blob-second__20T0q\"};"],"sourceRoot":""}