(this.webpackJsonpdotdot=this.webpackJsonpdotdot||[]).push([[0],{105:function(e,t,a){e.exports={chat:"Chat_chat__LEZtX"}},112:function(e,t,a){e.exports={onlineUsers:"OnlineUsers_onlineUsers__2Umxk"}},116:function(e,t,a){e.exports={login:"Login_login__38Hzs"}},119:function(e,t,a){e.exports=a(186)},153:function(e,t){},185:function(e,t,a){},186:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),s=a(11),o=a.n(s),c=a(43),l=a(7),i=a(44),u=/^[A-Za-z0-9]+(?:[ _][A-Za-z0-9]+)*_?$/i,m=Object(i.a)((function(e,t){switch(console.log("REDUCER",t),t.type){case"login":if(e.offline||(e.auth.checked=!0),!t.payload){e.auth.loggedIn=!1,e.auth.user=null;break}e.offline=!1,e.auth.loggedIn=!0,e.auth.user=t.payload.user;break;case"offline":e.offline=!0,e.error=null,e.socket.connected=!1;break;case"error":e.error=t.payload;break;case"socketConnected":e.socket.connected=t.payload,e.offline=!t.payload,e.error=null;break;case"onlineUsers":e.onlineUsers=t.payload;break;case"user_password":e.auth.user&&(e.auth.user.hasPassword=!0);break;case"message":var a=t.payload,n=e.messages.findIndex((function(e){return e.attributes.draft&&e.user.user_id===a.user.user_id}));if(n>-1&&e.messages.splice(n,1),a.message.trim().length<1)return;if(!a.attributes.draft){var r=e.messages[e.messages.length-1];if(r&&r.user.user_id===a.user.user_id&&r.attributes.private===a.attributes.private)return r.message+="\n".concat(a.message),void(r.timestamp=new Date(a.timestamp))}e.messages.push({timestamp:new Date(a.timestamp),attributes:a.attributes,message:a.message,user:a.user}),e.messages.length>100&&e.messages.shift();break;case"history":e.messages=t.payload.map((function(e){return e.timestamp=new Date(e.timestamp),e}))}})),d={auth:{checked:!1,loggedIn:!1,user:null},socket:{connected:!1},onlineUsers:[],messages:[],offline:!1,error:null},f=r.a.createContext({state:d,dispatch:function(){return console.warn("Using default reducer, check StateProvider"),d}}),p=function(e){var t=r.a.useReducer(m,e.state||d),a=Object(l.a)(t,2),n={state:a[0],dispatch:a[1]};return r.a.createElement(f.Provider,{value:n},e.children)},g=function(){return r.a.useContext(f)},h=g,b=a(104),v=a.n(b),E=Object(n.createContext)({socket:null}),_=function(e){var t=g(),a=t.state,s=t.dispatch,o=Object(n.useState)(null),c=Object(l.a)(o,2),i=c[0],u=c[1];Object(n.useEffect)((function(){if(s({type:"error",payload:null}),a.auth.loggedIn){var e=v()("https://api.dotdot.im",{reconnection:!0,timeout:2e3});e.on("connect",(function(){s({type:"socketConnected",payload:!0})})),e.on("users",(function(e){s({type:"onlineUsers",payload:e.users})})),e.on("message",(function(e){s({type:"message",payload:e})})),e.on("history",(function(e){s({type:"history",payload:e})})),e.on("connect_error",(function(e){s({type:"offline",payload:null})})),e.on("connect_timeout",(function(e){s({type:"offline",payload:null})})),e.on("error",(function(e){s({type:"socketConnected",payload:!1}),e?(s({type:"error",payload:e}),s({type:"login",payload:null})):s({type:"offline",payload:null})})),u(e)}}),[s,a.auth.loggedIn]);var m={socket:i};return r.a.createElement(E.Provider,{value:m},e.children)},y=a(30),w=a(193),k=a(194),j=a(111),O=a(51),C=a.n(O),x=function(e){var t={};return e.infinite&&(t.animationIterationCount="infinite",t.animationDirection="alternate"),r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:C.a.logo},r.a.createElement("div",{className:C.a.blob,style:t}),r.a.createElement("div",{className:C.a.blob,style:t})),r.a.createElement("svg",{className:C.a.svgFilter,xmlns:"http://www.w3.org/2000/svg",version:"1.1"},r.a.createElement("defs",null,r.a.createElement("filter",{id:"goo"},r.a.createElement("feGaussianBlur",{in:"SourceGraphic",stdDeviation:"10",result:"blur"}),r.a.createElement("feColorMatrix",{in:"blur",mode:"matrix",values:"1 0 0 0 0  0 1 0 0 0  0 0 1 0 0  0 0 0 18 -7",result:"goo"}),r.a.createElement("feBlend",{in:"SourceGraphic",in2:"goo"})))))},T=function(e){return r.a.createElement(r.a.Fragment,null,r.a.createElement(x,{infinite:!0}))},S=a(105),N=a.n(S),M=a(198),L=a(37),F=a(5),P=a.n(F),I=a(28),U=a(22),A=a.n(U),B=a(20),D=a(197),H=a(192),R=function(e){var t,a,n=h().state,s=n.onlineUsers.find((function(t){return t.user_id===e.message.user.user_id}))||e.message.user,o="#".concat(s.color),c="dotdot"===s.user_id,l=c||n.onlineUsers.findIndex((function(e){return e.user_id===s.user_id}))>-1&&s.isActive,i="circle";return s.user_id===(null===(t=n.auth.user)||void 0===t?void 0:t.user_id)?i=["far","dot-circle"]:e.message.attributes.draft&&(i="circle-notch"),e.message.attributes.private&&(i="lock"),c&&(i="cog"),l||(i="meh"),r.a.createElement("div",{className:P()(A.a.message,(a={},Object(I.a)(a,A.a.system,c),Object(I.a)(a,A.a.offline,!l),Object(I.a)(a,A.a.draft,e.message.attributes.draft),Object(I.a)(a,A.a.private,e.message.attributes.private),a)),key:e.message.timestamp.toDateString()},r.a.createElement("div",{className:P()(A.a.icon,Object(I.a)({},A.a.private,e.message.attributes.private)),style:{color:o,background:o}},e.message.attributes.private&&r.a.createElement(D.a,{placement:"right",overlay:r.a.createElement(H.a,{id:"user-".concat(s.user_id)},"Private message from ",r.a.createElement("b",null,"@",s.name),r.a.createElement("br",null),"Only you can see this.")},r.a.createElement(B.a,{icon:i})),!e.message.attributes.private&&r.a.createElement(B.a,{icon:i,spin:e.message.attributes.draft})),r.a.createElement("div",{className:P()(A.a.timestamp)},e.message.attributes.draft?"now":e.message.timestamp.toLocaleTimeString([],{hour:"numeric",minute:"2-digit"})),r.a.createElement("span",{className:P()(A.a.user),style:{color:o}},s.name),r.a.createElement("div",{className:P()(A.a.body)},e.message.message))},z=a(52),G=a.n(z),V=function(e){var t=e.boxRef,a=e.onScrollChanged,s=e.threshold,o=e.children,c=Object(n.useState)(-1),i=Object(l.a)(c,2),u=i[0],m=i[1],d=Object(n.useState)(0),f=Object(l.a)(d,2),p=f[0],g=f[1],h=Object(n.useRef)(null),b=Object(n.useCallback)((function(e){clearTimeout(h.current),a&&(h.current=setTimeout((function(){a(e)}),150))}),[a]),v=Object(n.useCallback)((function(){if(t&&t.current){var e=t.current.scrollHeight-t.current.offsetHeight;t.current.scrollTop=e,m(t.current.scrollTop),b(!0)}}),[t,b,m]),E=Object(n.useCallback)((function(e){return function(){if(t&&t.current){if(u>0){var a=s||100;if(u>0&&Math.abs(t.current.scrollTop-u)>a)return void b(!1);b(!0)}e&&v()}}}),[t,b,s,v,u]);return Object(n.useEffect)((function(){return window.addEventListener("resize",v,!0),t&&t.current&&t.current.addEventListener("scroll",E(!1),!0),function(){window.removeEventListener("resize",v,!0)}}),[t,v,E]),Object(n.useEffect)((function(){if(t.current){var e=t.current.scrollHeight;e!==p&&(g(e),E(!0)())}}),[t,p,E,o]),r.a.createElement(r.a.Fragment,null,o)},Z=function(){var e=h().state,t=Object(L.a)({scrollAtBottom:!0,unseenMessages:!1}),a=Object(l.a)(t,2),s=a[0],o=a[1],c=Object(n.useRef)(null),i=Object(n.useCallback)((function(e){o((function(t){t.scrollAtBottom=e,e&&(t.unseenMessages=!1)}))}),[o]),u=Object(n.useCallback)((function(){if(c&&c.current){var e=c.current.scrollHeight-c.current.offsetHeight;c.current.scrollTop=e,o((function(e){e.unseenMessages=!1}))}}),[o]);return Object(n.useEffect)((function(){o((function(e){e.unseenMessages=!e.scrollAtBottom}))}),[e.messages,o]),r.a.createElement("div",{className:G.a.messages},s.unseenMessages&&r.a.createElement("div",{className:P()(G.a.unseen)},r.a.createElement(w.a,{className:G.a.unseenContainer},r.a.createElement(M.a,{variant:"outline-secondary",size:"sm",onClick:u},r.a.createElement(B.a,{icon:"arrow-alt-circle-down"})," New messages"))),r.a.createElement("div",{className:P()(G.a.messageScroll),ref:c},r.a.createElement("div",{className:"container"},r.a.createElement(V,{boxRef:c,onScrollChanged:i},e.messages.map((function(e){return r.a.createElement(R,{key:e.timestamp.toDateString(),message:e})}))))))},X=a(196),q=a(63),W=a.n(q),J=function(){var e,t=Object(L.a)({message:"",private:!1,to:null,isCommand:!1}),a=Object(l.a)(t,2),s=a[0],o=a[1],c=Object(n.useRef)(null),i=Object(n.useContext)(E).socket,m=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(t||!(e.length<1||e.trim().length<1)){var a="message";s.isCommand&&(a="command"),null===i||void 0===i||i.emit(a,{message:e,attributes:{draft:t,private:s.private,to:s.to}})}},d="lock";return s.isCommand&&(d="code"),r.a.createElement(X.a,{noValidate:!0,onSubmit:function(e){e.preventDefault(),s.message.length<1||s.message.trim().length<1||(m(s.message),o((function(e){e.message="",e.private=!1,e.isCommand=!1})))},className:P()(W.a.textBox,"container",(e={},Object(I.a)(e,W.a.private,s.private),Object(I.a)(e,W.a.command,s.isCommand),e))},r.a.createElement(X.a.Group,{controlId:"chatForm.message"},r.a.createElement(X.a.Control,{as:"input",type:"text",placeholder:"Type a message...",autoFocus:!0,onChange:function(e){e.preventDefault(),clearTimeout(c.current);var t=e.currentTarget.value,a=!1,n=!1,r=null;if("/"===t[0])a=!0;else if("@"===t[0]){var s=t.split(" ");n=!0,s.length>0&&"@"===s[0][0]&&u.test(s[0].substr(1))&&(r=s[0].substr(1))}o((function(e){e.message=t,e.private=n,e.to=r,e.isCommand=a})),n||a||(c.current=setTimeout((function(){m(t,!0)}),100))},value:s.message}),r.a.createElement("span",null,r.a.createElement(B.a,{icon:d}))))},K=a(112),Y=a.n(K),Q=function(){var e=h().state;return r.a.createElement("div",{className:Y.a.onlineUsers},e.onlineUsers.map((function(t){var a,n="circle",s=t.user_id===(null===(a=e.auth.user)||void 0===a?void 0:a.user_id);return s&&(n=["far","dot-circle"]),t.isActive||(n=s?["far","meh"]:"meh"),r.a.createElement(D.a,{key:t.user_id,placement:"bottom",overlay:r.a.createElement(H.a,{id:"user-".concat(t.user_id)},"@",t.name)},r.a.createElement("span",{style:{color:"#".concat(t.color)}},r.a.createElement(B.a,{icon:n})))})))},$=a(195),ee=a(64),te=a.n(ee),ae=a(53),ne=a.n(ae),re=a(73),se=a(74),oe=a.n(se),ce="";oe.a.defaults.withCredentials=!0;var le=function(){var e=Object(re.a)(ne.a.mark((function e(t,a,n){var r,s,o;return ne.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}throw new Error("'url' is required for fetching data");case 2:return r="".concat("https://api.dotdot.im").concat(t),s={url:r,method:a,data:n,timeout:6e3,withCredentials:!0,xsrfHeaderName:"x-csrf-token",headers:{}},ce.length>0&&(s.headers["x-csrf-token"]=ce),e.prev=5,e.next=8,oe()(s);case 8:return(o=e.sent).headers["x-csrf-token"]&&(ce=o.headers["x-csrf-token"]),e.next=12,o.data;case 12:return e.abrupt("return",e.sent);case 15:if(e.prev=15,e.t0=e.catch(5),!e.t0.response){e.next=21;break}throw console.warn("useFetch error on ".concat(a," ").concat(t),e.t0.response),{status:e.t0.response.status,message:ie(e.t0),errors:ue(e.t0)};case 21:throw console.warn("useFetch network error on ".concat(a," ").concat(t),e.t0),{status:500,message:e.t0.message,errors:[e.t0.message]};case 24:case"end":return e.stop()}}),e,null,[[5,15]])})));return function(t,a,n){return e.apply(this,arguments)}}();function ie(e){return e.response&&e.response.data?ue(e).join(". "):e.message||"An error occurred"}function ue(e){return e.response&&e.response.data?function(e){for(var t=0;t<(arguments.length<=1?0:arguments.length-1);t++){var a=t+1<1||arguments.length<=t+1?void 0:arguments[t+1];if(Array.isArray(a))return a;if("string"===typeof a)return[a]}return[e]}("An error occurred",e.response.data,e.response.data.errors,e.response.data.error):[e.message||"An error occurred"]}var me=function(){var e=h(),t=e.state,a=e.dispatch,s=Object(n.useState)(!1),o=Object(l.a)(s,2),c=o[0],i=o[1],u=Object(n.useState)(!1),m=Object(l.a)(u,2),d=m[0],f=m[1],p=Object(n.useState)(""),g=Object(l.a)(p,2),b=g[0],v=g[1],E=Object(n.useState)(""),_=Object(l.a)(E,2),y=_[0],w=_[1],k=function(){return i(!1)},j=te.a.unlocked,O="lock-open",C="Set a password to keep your username",x="Claim Username";return t.auth.user&&t.auth.user.hasPassword&&(j=te.a.locked,O="lock",C="Change your password",x="Update Password"),r.a.createElement("div",{className:te.a.passwordLock},r.a.createElement(D.a,{placement:"bottom",delay:500,overlay:r.a.createElement(H.a,{id:"passwordLock"},C)},r.a.createElement(M.a,{variant:"link",className:j,style:{padding:0},onClick:function(){return i(!0)}},r.a.createElement(B.a,{icon:O}))),r.a.createElement($.a,{show:c,onHide:k},r.a.createElement(X.a,{noValidate:!0,validated:d,onSubmit:function(e){(e.preventDefault(),e.stopPropagation(),f(!0),e.currentTarget.checkValidity())&&le("/password","POST",{password:b,repeatPassword:y}).then((function(){a({type:"user_password",payload:!0}),i(!1),f(!1),v(""),w("")})).catch((function(e){a({type:"error",payload:e.errors.join(", ")})}))}},r.a.createElement($.a.Header,{closeButton:!0},r.a.createElement($.a.Title,null,x)),r.a.createElement($.a.Body,null,r.a.createElement(X.a.Group,{controlId:"pwd.new"},r.a.createElement(X.a.Control,{as:"input",type:"password",placeholder:"Password...",autoFocus:!0,required:!0,minLength:6,onChange:function(e){v(e.currentTarget.value)},value:b}),r.a.createElement(X.a.Control.Feedback,{type:"invalid"},"The password is too short. Minimum length is 6 characters.")),r.a.createElement(X.a.Group,{controlId:"pwd.new"},r.a.createElement(X.a.Control,{as:"input",type:"password",placeholder:"Repeat Password...",required:!0,minLength:6,pattern:b,onChange:function(e){w(e.currentTarget.value)},value:y}),r.a.createElement(X.a.Control.Feedback,{type:"invalid"},"The passwords don't match!"))),r.a.createElement($.a.Footer,null,r.a.createElement(M.a,{variant:"secondary",onClick:k},"Close"),r.a.createElement(M.a,{type:"submit",variant:"primary"},"Set password")))))},de=function(){var e=g().state,t=r.a.createElement(T,null);return e.socket.connected&&(t=r.a.createElement("div",{className:N.a.chat},r.a.createElement(w.a,null,r.a.createElement(k.a,null,r.a.createElement(j.a,null,r.a.createElement(me,null)),r.a.createElement(j.a,null,r.a.createElement(Q,null)))),r.a.createElement(Z,null),r.a.createElement(J,null))),t},fe=function(){return r.a.createElement(r.a.Fragment,null,r.a.createElement(T,null))},pe=function(e){var t=g().state;return t.auth.checked?t.auth.loggedIn?r.a.createElement(y.b,{path:e.path,exact:e.exact,component:e.component}):r.a.createElement(y.a,{to:"/login"}):r.a.createElement(fe,null)},ge=function(e){var t=g().state;return t.auth.checked?t.auth.loggedIn?r.a.createElement(y.a,{to:"/"}):r.a.createElement(y.b,{path:e.path,exact:e.exact,component:e.component}):r.a.createElement(fe,null)},he=a(77),be=a.n(he),ve=function(){var e=g().state;if(!e.offline&&!e.error)return null;var t=e.error;return Array.isArray(t)&&(t=t.join(". ")),"string"!==typeof t&&(t=String(t)),e.error?r.a.createElement("div",{className:be.a.offline},"Error: ",t):r.a.createElement("div",{className:be.a.offline},"You seem to be offline! Please try again later")},Ee=a(115),_e=a.n(Ee),ye=a(116),we=a.n(ye),ke=function(){var e=g().dispatch,t=Object(L.a)({username:"",password:"",hasPassword:!1,loading:!1}),a=Object(l.a)(t,2),s=a[0],o=a[1],c=Object(n.useRef)(null),i="light";return window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches&&(i="dark"),r.a.createElement(w.a,{className:P()(we.a.login,"mt-4")},r.a.createElement(x,null),r.a.createElement(X.a,{noValidate:!0,onSubmit:function(e){e.preventDefault(),c.current.execute()}},r.a.createElement(X.a.Group,{controlId:"loginForm.username"},r.a.createElement(X.a.Control,{as:"input",type:"text",placeholder:"What's your name?",disabled:s.loading,autoFocus:!0,minLength:1,maxLength:20,onChange:function(e){var t=e.currentTarget.value;o((function(e){e.username=t}))},value:s.username}),s.hasPassword&&r.a.createElement(X.a.Control,{as:"input",className:"mt-2",type:"password",placeholder:"Password...",disabled:s.loading,autoFocus:!0,onChange:function(e){var t=e.currentTarget.value;o((function(e){e.password=t}))},value:s.password}),r.a.createElement(_e.a,{ref:c,size:"invisible",theme:i,sitekey:"562bb3f7-9944-46f3-aca9-553dd470a8c1",onVerify:function(t){if(t&&!s.loading){o((function(e){e.loading=!0}));var a={username:s.username,password:s.password,captchaToken:t};le("/auth","POST",a).then((function(t){if(!t||!t.user.user_id)return console.warn("Invalid user object"),void e({type:"login",payload:t});e({type:"login",payload:t})})).catch((function(t){console.log("login fail reason",t),400!==t.status&&e({type:"error",payload:t.errors.join(", ")}),c.current.resetCaptcha&&c.current.resetCaptcha(),o((function(e){e.loading=!1,400===t.status&&(e.hasPassword=!0)}))}))}}}),r.a.createElement("button",{type:"submit",style:{visibility:"hidden"}},"Login"))))},je=function e(t){le("/auth","GET").then((function(e){if(!e||!e.user.user_id)return console.warn("Invalid user object"),void t({type:"login",payload:null});t({type:"login",payload:e})})).catch((function(a){console.log("Login check failed",a),"Network Error"===a.message?(t({type:"offline",payload:null}),setTimeout((function(){e(t)}),2e3)):(401!==a.status&&t({type:"error",payload:a.errors.join(", ")}),t({type:"login",payload:null}))}))},Oe=function(){var e=h(),t=e.state,a=e.dispatch;return Object(n.useEffect)((function(){t.auth.checked||je(a)}),[t.auth.checked,a]),r.a.createElement(r.a.Fragment,null,r.a.createElement(ve,null),r.a.createElement(y.d,null,r.a.createElement(ge,{path:"/login",component:ke}),r.a.createElement(pe,{path:"/",component:de})))},Ce=a(117),xe=a.n(Ce),Te=function(){var e=h().state,t=Object(n.useContext)(E).socket,a=Object(n.useState)(!0),s=Object(l.a)(a,2),o=s[0],c=s[1],i=Object(n.useState)(!1),u=Object(l.a)(i,2),m=u[0],d=u[1],f=Object(n.useCallback)((function(t){var a=e.auth.user;!o&&a&&a.user_id!==t.user.user_id&&d(!0)}),[o,e.auth.user]);return Object(n.useEffect)((function(){t&&t.on("message",f)}),[t,f]),window.onfocus=function(){d(!1),c(!0)},window.onblur=function(){c(!1)},r.a.createElement(xe.a,null,r.a.createElement("title",null,m?"\u2022 dotdot":"dotdot"))},Se=a(45),Ne=a(25),Me=a(78);Se.b.add(Ne.g,Ne.h,Ne.b,Ne.f,Me.a,Ne.c,Ne.d,Ne.e,Ne.a,Ne.i,Me.b);a(185);var Le=r.a.createElement(c.a,{basename:"/"},r.a.createElement(p,null,r.a.createElement(_,null,r.a.createElement(Te,null),r.a.createElement(Oe,null))));o.a.render(Le,document.getElementById("root"))},22:function(e,t,a){e.exports={message:"Message_message__2v30T",system:"Message_system__2g6ZE",user:"Message_user__3HofW",timestamp:"Message_timestamp__2armv",offline:"Message_offline__32gHu",icon:"Message_icon__ATXFm",body:"Message_body__32TEj",draft:"Message_draft__1zB7h",header:"Message_header__3wUCX",private:"Message_private__ORZ48"}},51:function(e,t,a){e.exports={logo:"Logo_logo__30xDu",svgFilter:"Logo_svgFilter__1s9i7",blob:"Logo_blob__1iSwo","blob-first":"Logo_blob-first__3YKrD","blob-second":"Logo_blob-second__2r5Nx"}},52:function(e,t,a){e.exports={messages:"Messages_messages__tCmp1",messageScroll:"Messages_messageScroll__CCnSp",unseen:"Messages_unseen__gVw6f",unseenContainer:"Messages_unseenContainer__3haBw"}},63:function(e,t,a){e.exports={textBox:"TextBox_textBox__McZeC",private:"TextBox_private__1kesE",command:"TextBox_command__1uXWO"}},64:function(e,t,a){e.exports={passwordLock:"PasswordLock_passwordLock__2FTiA",unlocked:"PasswordLock_unlocked__21MTQ",pulse:"PasswordLock_pulse__2T-_F",locked:"PasswordLock_locked__1mCl-"}},77:function(e,t,a){e.exports={offline:"OfflineCheck_offline__2vKbm"}}},[[119,1,2]]]);
//# sourceMappingURL=main.7c20838d.chunk.js.map