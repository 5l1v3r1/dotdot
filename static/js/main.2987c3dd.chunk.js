(this.webpackJsonpdotdot=this.webpackJsonpdotdot||[]).push([[0],{105:function(e,t,n){e.exports={passwordLock:"PasswordLock_passwordLock__2FTiA",pulse:"PasswordLock_pulse__2T-_F"}},108:function(e,t,n){e.exports={login:"Login_login__38Hzs"}},112:function(e,t,n){e.exports=n(179)},146:function(e,t){},178:function(e,t,n){},179:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),o=n(14),s=n.n(o),c=n(32),l=n(9),u=n(33),i=Object(u.a)((function(e,t){switch(console.log("REDUCER",t),t.type){case"login":if(e.offline||(e.auth.checked=!0),e.error=null,!t.payload){e.auth.loggedIn=!1,e.auth.user=null,e.auth.token=null;break}e.offline=!1,e.auth.loggedIn=!0,e.auth.user=t.payload.user,e.auth.token=t.payload.token;break;case"offline":e.offline=!0,e.error=null,e.auth.token=null,e.socket.connected=!1;break;case"error":e.error=t.payload;break;case"socketConnected":e.socket.connected=t.payload,t.payload||(e.auth.token=null)}})),m={auth:{checked:!1,loggedIn:!1,user:null,token:null},socket:{connected:!1,key:null},offline:!1,error:null},d=r.a.createContext({state:m,dispatch:function(){return console.warn("Using default reducer, check StateProvider"),m}}),f=function(e){var t=r.a.useReducer(i,m),n=Object(l.a)(t,2),a={state:n[0],dispatch:n[1]};return r.a.createElement(d.Provider,{value:a},e.children)},g=function(){return r.a.useContext(d)},p=g,h=n(91),E=n.n(h),b="https://dotdotim.herokuapp.com",v=Object(a.createContext)({socket:null}),k=function(e){var t=g(),n=t.state,o=t.dispatch,s=Object(a.useState)(null),c=Object(l.a)(s,2),u=c[0],i=c[1];Object(a.useEffect)((function(){if(o({type:"error",payload:null}),n.auth.loggedIn&&n.auth.token){var e=E()(b,{reconnection:!0,timeout:2e3,query:{token:n.auth.token}});e.on("connect",(function(){o({type:"socketConnected",payload:!0})})),e.on("connect_error",(function(e){o({type:"offline",payload:null})})),e.on("connect_timeout",(function(e){o({type:"offline",payload:null})})),e.on("error",(function(e){o({type:"socketConnected",payload:!1}),o(e?{type:"error",payload:e}:{type:"offline",payload:null})})),i(e)}}),[o,n.auth.loggedIn,n.auth.token]);var m={socket:u};return r.a.createElement(v.Provider,{value:m},e.children)},_=n(34),y=n(57),x=n(22),j=n(186),w=n(97),O=n(187),C=n(36),N=n.n(C),F=function(e){var t={};return e.infinite&&(t.animationIterationCount="infinite",t.animationDirection="alternate"),r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:N.a.logo},r.a.createElement("div",{className:N.a.blob,style:t}),r.a.createElement("div",{className:N.a.blob,style:t})),r.a.createElement("svg",{className:N.a.svgFilter,xmlns:"http://www.w3.org/2000/svg",version:"1.1"},r.a.createElement("defs",null,r.a.createElement("filter",{id:"goo"},r.a.createElement("feGaussianBlur",{in:"SourceGraphic",stdDeviation:"10",result:"blur"}),r.a.createElement("feColorMatrix",{in:"blur",mode:"matrix",values:"1 0 0 0 0  0 1 0 0 0  0 0 1 0 0  0 0 0 18 -7",result:"goo"}),r.a.createElement("feBlend",{in:"SourceGraphic",in2:"goo"})))))},L=function(e){return r.a.createElement(r.a.Fragment,null,r.a.createElement(F,{infinite:!0}))},I=n(92),T=n.n(I),S=n(21),D=n(5),M=n.n(D),A=n(93),P=n(37),U=n.n(P),G=function(e){var t,n=p().state,a="#".concat(e.message.user.color),o={borderLeft:"solid 5px ".concat(a)};return e.message.attributes.draft&&(o.color="#aaa"),e.message.attributes.private&&(o.color="orange"),r.a.createElement("div",{className:M()(U.a.message),key:e.message.id,style:o},e.message.message,r.a.createElement("span",{className:M()(U.a.user,Object(A.a)({},U.a.op,e.message.user.user_id===(null===(t=n.auth.user)||void 0===t?void 0:t.user_id)))},r.a.createElement("i",null,"@"),e.message.user.name),r.a.createElement("div",{className:M()(U.a.dots),style:{backgroundColor:a}}))},R=n(94),B=n.n(R),H=function(){var e=Object(S.a)({messages:[]}),t=Object(l.a)(e,2),n=t[0],o=t[1],s=Object(a.useContext)(v).socket,c=Object(a.useRef)(null);return Object(a.useEffect)((function(){c&&c.current&&(c.current.scrollTop=c.current.scrollHeight)}),[n.messages]),Object(a.useEffect)((function(){s&&s.on("message",(function(e){o((function(t){var n=t.messages.findIndex((function(t){return t.attributes.draft&&t.user.user_id===e.user.user_id}));n>-1&&t.messages.splice(n,1);var a=t.messages[t.messages.length-1];a&&a.user.user_id===e.user.user_id?a.message+="\n".concat(e.message):t.messages.push({id:t.messages.length,attributes:e.attributes,message:e.message,user:e.user})}))}))}),[s,o]),r.a.createElement("div",{className:M()(B.a.messages,"my-4"),ref:c},n.messages.map((function(e){return r.a.createElement(G,{key:e.id,message:e})})))},Y=n(188),q=n(95),J=n.n(q),K=function(){var e=Object(S.a)({message:""}),t=Object(l.a)(e,2),n=t[0],o=t[1],s=Object(a.useRef)(null),c=Object(a.useContext)(v).socket;return r.a.createElement(Y.a,{noValidate:!0,onSubmit:function(e){e.preventDefault(),n.message.length<1||n.message.trim().length<1||(null===c||void 0===c||c.emit("message",{message:n.message}),o((function(e){e.message=""})))},className:J.a.textBox},r.a.createElement(Y.a.Group,{controlId:"chatForm.message"},r.a.createElement(Y.a.Control,{as:"input",type:"text",placeholder:"Type a message...",autoFocus:!0,onChange:function(e){e.preventDefault(),clearTimeout(s.current);var t=e.currentTarget.value;o((function(e){e.message=t})),s.current=setTimeout((function(){var e;(e=t).length<1||e.trim().length<1||null===c||void 0===c||c.emit("draft",{message:e})}),100)},value:n.message})))},V=n(189),W=n(185),z=n(98),Q=n.n(z),X=function(){var e=Object(S.a)({users:[]}),t=Object(l.a)(e,2),n=t[0],o=t[1],s=Object(a.useContext)(v).socket;return Object(a.useEffect)((function(){s&&s.on("users",(function(e){o((function(t){t.users=e.users}))}))}),[s,o]),r.a.createElement("div",{className:Q.a.onlineUsers},n.users.map((function(e){return r.a.createElement(V.a,{key:e.user_id,placement:"bottom",overlay:r.a.createElement(W.a,{id:"user-".concat(e.user_id)},"@",e.name)},r.a.createElement("span",{style:{color:"#".concat(e.color)}},"\u2022"))})))},Z=n(104),$=n(190),ee=n(105),te=n.n(ee),ne=function(){return r.a.createElement("div",{className:te.a.passwordLock},r.a.createElement(V.a,{placement:"bottom",delay:500,overlay:r.a.createElement(W.a,{id:"passwordLock"},"Set a password to keep your username")},r.a.createElement($.a,{variant:"link"},r.a.createElement(Z.a,{icon:"lock-open"}))))},ae=function(){var e=g().state,t=r.a.createElement(L,null);return e.socket.connected&&(t=r.a.createElement(r.a.Fragment,null,r.a.createElement(j.a,null,r.a.createElement(w.a,null,r.a.createElement(ne,null)),r.a.createElement(w.a,null,r.a.createElement(X,null))),r.a.createElement(H,null),r.a.createElement(K,null))),r.a.createElement(O.a,{className:T.a.container},t)},re=function(){return r.a.createElement(r.a.Fragment,null,r.a.createElement(L,null))},oe=function(e){var t=g().state;return t.auth.checked?t.auth.loggedIn?r.a.createElement(x.b,{path:e.path,exact:e.exact,component:e.component}):r.a.createElement(x.a,{to:"/login"}):r.a.createElement(re,null)},se=function(e){var t=g().state;return t.auth.checked?t.auth.loggedIn?r.a.createElement(x.a,{to:"/"}):r.a.createElement(x.b,{path:e.path,exact:e.exact,component:e.component}):r.a.createElement(re,null)},ce=n(62),le=n.n(ce),ue=function(){var e=g().state;return e.offline||e.error?e.error?r.a.createElement("div",{className:le.a.offline},"Error: ",e.error):r.a.createElement("div",{className:le.a.offline},"You seem to be offline! Please try again later"):null},ie=n(38),me=n.n(ie),de=n(63),fe=n(64),ge=n.n(fe),pe="";ge.a.defaults.withCredentials=!0;var he=function(){var e=Object(de.a)(me.a.mark((function e(t,n,a){var r,o,s;return me.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}throw new Error("'url' is required for fetching data");case 2:return r="".concat(b).concat(t),o={url:r,method:n,data:a,timeout:6e3,withCredentials:!0,xsrfHeaderName:"x-csrf-token",headers:{}},pe.length>0&&(o.headers["x-csrf-token"]=pe),e.prev=5,e.next=8,ge()(o);case 8:return(s=e.sent).headers["x-csrf-token"]&&(pe=s.headers["x-csrf-token"]),e.next=12,s.data;case 12:return e.abrupt("return",e.sent);case 15:if(e.prev=15,e.t0=e.catch(5),!e.t0.response){e.next=21;break}throw console.warn("useFetch error on ".concat(n," ").concat(t),e.t0.response),{status:e.t0.response.status,message:Ee(e.t0),errors:be(e.t0)};case 21:throw console.warn("useFetch network error on ".concat(n," ").concat(t),e.t0),{status:500,message:e.t0.message,errors:[e.t0.message]};case 24:case"end":return e.stop()}}),e,null,[[5,15]])})));return function(t,n,a){return e.apply(this,arguments)}}();function Ee(e){return e.response&&e.response.data?be(e).join(". "):e.message||"An error occurred"}function be(e){return e.response&&e.response.data?function(e){for(var t=0;t<(arguments.length<=1?0:arguments.length-1);t++){var n=t+1<1||arguments.length<=t+1?void 0:arguments[t+1];if(Array.isArray(n))return n;if("string"===typeof n)return[n]}return[e]}("An error occurred",e.response.data,e.response.data.errors,e.response.data.error):[e.message||"An error occurred"]}var ve=n(108),ke=n.n(ve),_e=function(){var e=g().dispatch,t=Object(S.a)({username:"",loading:!1}),n=Object(l.a)(t,2),a=n[0],o=n[1];return r.a.createElement(O.a,{className:M()(ke.a.login,"mt-4")},r.a.createElement(F,null),r.a.createElement(Y.a,{noValidate:!0,onSubmit:function(t){if(t.preventDefault(),!a.loading){o((function(e){e.loading=!0}));var n={username:a.username};he("/auth","POST",n).then((function(t){if(!t||!t.user.user_id)return console.warn("Invalid user object"),void e({type:"login",payload:null});e({type:"login",payload:t})})).catch((function(t){console.log("login fail reason",t),e({type:"error",payload:t.errors.join(", ")}),o((function(e){e.loading=!1}))}))}}},r.a.createElement(Y.a.Group,{controlId:"loginForm.username"},r.a.createElement(Y.a.Control,{as:"input",type:"text",placeholder:"What's your name?",disabled:a.loading,autoFocus:!0,onChange:function(e){var t=e.currentTarget.value;o((function(e){e.username=t}))},value:a.username}))))},ye=function e(t){he("/auth","GET").then((function(e){if(!e||!e.user.user_id)return console.warn("Invalid user object"),void t({type:"login",payload:null});t({type:"login",payload:e})})).catch((function(n){console.log("Login check failed",n),"Network Error"===n.message?(t({type:"offline",payload:null}),setTimeout((function(){e(t)}),2e3)):t({type:"error",payload:n.errors.join(", ")})}))},xe=function(){var e=p(),t=e.state,n=e.dispatch;return Object(a.useEffect)((function(){t.auth.checked&&t.auth.token||ye(n)}),[t.auth.checked,t.auth.token,n]),r.a.createElement(r.a.Fragment,null,r.a.createElement(ue,null),r.a.createElement(x.d,null,r.a.createElement(se,{path:"/login",component:_e}),r.a.createElement(oe,{path:"/",component:ae})))},je=n(109),we=n.n(je),Oe=function(){var e=Object(a.useContext)(v).socket,t=Object(a.useState)(!0),n=Object(l.a)(t,2),o=n[0],s=n[1],c=Object(a.useState)(!1),u=Object(l.a)(c,2),i=u[0],m=u[1],d=function(){o||m(!0)};return Object(a.useEffect)((function(){e&&e.on("message",d)}),[e,d]),window.onfocus=function(){m(!1),s(!0)},window.onblur=function(){s(!1)},r.a.createElement(we.a,null,r.a.createElement("title",null,i?"\u2022 dotdot":"dotdot"))};n(178);_.b.add(y.a,y.b);var Ce=r.a.createElement(c.a,{basename:"/dotdot/"},r.a.createElement(f,null,r.a.createElement(k,null,r.a.createElement(Oe,null),r.a.createElement(xe,null))));s.a.render(Ce,document.getElementById("root"))},36:function(e,t,n){e.exports={logo:"Logo_logo__30xDu",svgFilter:"Logo_svgFilter__1s9i7",blob:"Logo_blob__1iSwo","blob-first":"Logo_blob-first__3YKrD","blob-second":"Logo_blob-second__2r5Nx"}},37:function(e,t,n){e.exports={message:"Message_message__2v30T",dots:"Message_dots__24igM",user:"Message_user__3HofW",op:"Message_op__3lLYM"}},62:function(e,t,n){e.exports={offline:"OfflineCheck_offline__2vKbm"}},92:function(e,t,n){e.exports={container:"Chat_container__22QAh"}},94:function(e,t,n){e.exports={messages:"Messages_messages__tCmp1"}},95:function(e,t,n){},98:function(e,t,n){e.exports={onlineUsers:"OnlineUsers_onlineUsers__2Umxk"}}},[[112,1,2]]]);
//# sourceMappingURL=main.2987c3dd.chunk.js.map