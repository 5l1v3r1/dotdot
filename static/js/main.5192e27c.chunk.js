(this.webpackJsonpdotdot=this.webpackJsonpdotdot||[]).push([[0],{102:function(e,t,a){e.exports={onlineUsers:"OnlineUsers_onlineUsers__2Umxk"}},110:function(e,t,a){e.exports={login:"Login_login__38Hzs"}},113:function(e,t,a){e.exports=a(180)},153:function(e,t){},179:function(e,t,a){},180:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),o=a(15),s=a.n(o),l=a(33),c=a(92),u=a.n(c),i=a(11),m=a(34),d=Object(m.a)((function(e,t){switch(console.log("REDUCER",t),t.type){case"login":if(e.auth.checked=!0,e.error=null,e.offline=!1,!t.payload){e.auth.loggedIn=!1,e.auth.user=null,e.auth.token=null;break}e.auth.loggedIn=!0,e.auth.user=t.payload.user,e.auth.token=t.payload.token;break;case"offline":e.offline=!0,e.error=null;break;case"error":e.error=t.payload;break;case"socketConnected":e.socket.connected=t.payload,t.payload||(e.auth.checked=!1)}})),f={auth:{checked:!1,loggedIn:!1,user:null,token:null},socket:{connected:!1,key:null},offline:!1,error:null},g=r.a.createContext({state:f,dispatch:function(){return console.warn("Using default reducer, check StateProvider"),f}}),p=function(e){var t=r.a.useReducer(d,f),a=Object(i.a)(t,2),n={state:a[0],dispatch:a[1]};return r.a.createElement(g.Provider,{value:n},e.children)},h=function(){return r.a.useContext(g)},E=h,v=a(93),b=a.n(v),y="https://dotdotim.herokuapp.com",_=Object(n.createContext)({socket:null}),k=function(e){var t=h(),a=t.state,o=t.dispatch,s=Object(n.useState)(null),l=Object(i.a)(s,2),c=l[0],u=l[1];Object(n.useEffect)((function(){if(o({type:"error",payload:null}),a.auth.loggedIn){var e=b()(y,{reconnection:!0,timeout:2e3,query:{token:a.auth.token}});e.on("connect",(function(){o({type:"socketConnected",payload:!0})})),e.on("connect_error",(function(e){o({type:"offline",payload:null})})),e.on("connect_timeout",(function(e){o({type:"offline",payload:null})})),e.on("error",(function(e){o({type:"login",payload:null}),o({type:"socketConnected",payload:!1}),o(e?{type:"error",payload:e}:{type:"offline",payload:null})})),u(e)}}),[o,a.auth.loggedIn,a.auth.token]);var m={socket:c};return r.a.createElement(_.Provider,{value:m},e.children)},x=a(35),j=a(9),O=a(94),w=a(58),C=a(23),N=a(187),F=a(95),I=function(e){return r.a.createElement(r.a.Fragment,null,r.a.createElement(F.a,{icon:"spinner",pulse:!0})," ",e.text||"Loading")},L=a(96),T=a.n(L),D=a(22),M=a(5),S=a.n(M),U=a(97),A=a(37),G=a.n(A),P=function(e){var t,a=E().state,n="#".concat(e.message.user.color),o={borderLeft:"solid 5px ".concat(n)};return e.draft&&(o.color="#aaa"),r.a.createElement("div",{className:S()(G.a.message),key:e.message.id,style:o},e.message.message,r.a.createElement("span",{className:S()(G.a.user,Object(U.a)({},G.a.op,e.message.user.user_id===(null===(t=a.auth.user)||void 0===t?void 0:t.user_id)))},r.a.createElement("i",null,"@"),e.message.user.name),r.a.createElement("div",{className:S()(G.a.dots),style:{backgroundColor:n}}))},R=a(98),B=a.n(R),H=function(){var e=Object(D.a)({messages:[],drafts:{}}),t=Object(i.a)(e,2),a=t[0],o=t[1],s=Object(n.useContext)(_).socket,l=Object(n.useRef)(null);return Object(n.useEffect)((function(){l&&l.current&&(l.current.scrollTop=l.current.scrollHeight)}),[a.messages]),Object(n.useEffect)((function(){s&&(s.on("message",(function(e){o((function(t){delete t.drafts[e.user.user_id];var a=t.messages[t.messages.length-1];a&&a.user.user_id===e.user.user_id?a.message+="\n".concat(e.message):t.messages.push({id:t.messages.length,message:e.message,user:e.user})}))})),s.on("draft",(function(e){o((function(t){e.message.trim().length<1?delete t.drafts[e.user.user_id]:t.drafts[e.user.user_id]=e}))})))}),[s,o]),r.a.createElement("div",{className:S()(B.a.messages,"my-4"),ref:l},a.messages.map((function(e){return r.a.createElement(P,{key:e.id,message:e})})),Object.values(a.drafts).map((function(e){return r.a.createElement(P,{key:e.id,message:e,draft:!0})})))},q=a(189),Y=a(99),J=a.n(Y),K=function(){var e=Object(D.a)({message:""}),t=Object(i.a)(e,2),a=t[0],o=t[1],s=Object(n.useRef)(null),l=Object(n.useContext)(_).socket;return r.a.createElement(q.a,{noValidate:!0,onSubmit:function(e){e.preventDefault(),a.message.length<1||a.message.trim().length<1||(null===l||void 0===l||l.emit("message",{message:a.message}),o((function(e){e.message=""})))},className:J.a.textBox},r.a.createElement(q.a.Group,{controlId:"chatForm.message"},r.a.createElement(q.a.Control,{as:"input",type:"text",placeholder:"Type a message...",autoFocus:!0,onChange:function(e){e.preventDefault(),clearTimeout(s.current);var t=e.currentTarget.value;o((function(e){e.message=t})),s.current=setTimeout((function(){var e;(e=t).length<1||e.trim().length<1||null===l||void 0===l||l.emit("draft",{message:e})}),100)},value:a.message})))},V=a(190),W=a(186),z=a(102),Q=a.n(z),X=function(){var e=Object(D.a)({users:[]}),t=Object(i.a)(e,2),a=t[0],o=t[1],s=Object(n.useContext)(_).socket;return Object(n.useEffect)((function(){s&&s.on("users",(function(e){console.log("users",e),o((function(t){t.users=e.users}))}))}),[s,o]),r.a.createElement("div",{className:Q.a.onlineUsers},a.users.map((function(e){return r.a.createElement(V.a,{key:e.user_id,placement:"bottom",overlay:r.a.createElement(W.a,{id:"user-".concat(e.user_id)},"@",e.name)},r.a.createElement("span",{style:{color:"#".concat(e.color)}},"\u2022"))})))},Z=function(){var e=h().state,t=r.a.createElement(I,null);return e.socket.connected&&(t=r.a.createElement(r.a.Fragment,null,r.a.createElement(X,null),r.a.createElement(H,null),r.a.createElement(K,null))),r.a.createElement(N.a,{className:T.a.container},t)},$=a(188),ee=a(101),te=function(){return r.a.createElement(r.a.Fragment,null,r.a.createElement("header",null,r.a.createElement("div",{className:"bg-angle"}),r.a.createElement("section",null,r.a.createElement(N.a,null,r.a.createElement($.a,null,r.a.createElement(ee.a,{md:{span:6,offset:3}},r.a.createElement("div",{className:"text-center mt-5"},r.a.createElement("h4",{className:"my-2",style:{color:"#fff"}},r.a.createElement(I,null)))))))))},ae=function(e){var t=h().state;return t.auth.checked?t.auth.loggedIn?r.a.createElement(C.b,{path:e.path,exact:e.exact,component:e.component}):r.a.createElement(C.a,{to:"/login"}):r.a.createElement(te,null)},ne=function(e){var t=h().state;return t.auth.checked?t.auth.loggedIn?r.a.createElement(C.a,{to:"/"}):r.a.createElement(C.b,{path:e.path,exact:e.exact,component:e.component}):r.a.createElement(te,null)},re=a(63),oe=a.n(re),se=function(){var e=h().state;return e.offline||e.error?e.error?r.a.createElement("div",{className:oe.a.offline},"Error: ",e.error):r.a.createElement("div",{className:oe.a.offline},"You seem to be offline! Please try again later"):null},le=a(38),ce=a.n(le),ue=a(64),ie=a(65),me=a.n(ie),de="";me.a.defaults.withCredentials=!0;var fe=function(){var e=Object(ue.a)(ce.a.mark((function e(t,a,n){var r,o,s;return ce.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}throw new Error("'url' is required for fetching data");case 2:return r="".concat(y).concat(t),o={url:r,method:a,data:n,timeout:6e3,withCredentials:!0,xsrfHeaderName:"x-csrf-token",headers:{}},de.length>0&&(o.headers["x-csrf-token"]=de),e.prev=5,e.next=8,me()(o);case 8:return(s=e.sent).headers["x-csrf-token"]&&(de=s.headers["x-csrf-token"]),e.next=12,s.data;case 12:return e.abrupt("return",e.sent);case 15:if(e.prev=15,e.t0=e.catch(5),!e.t0.response){e.next=21;break}throw console.warn("useFetch error on ".concat(a," ").concat(t),e.t0.response),{status:e.t0.response.status,message:ge(e.t0),errors:pe(e.t0)};case 21:throw console.warn("useFetch network error on ".concat(a," ").concat(t),e.t0),{status:500,message:e.t0.message,errors:[e.t0.message]};case 24:case"end":return e.stop()}}),e,null,[[5,15]])})));return function(t,a,n){return e.apply(this,arguments)}}();function ge(e){return e.response&&e.response.data?pe(e).join(". "):e.message||"An error occurred"}function pe(e){return e.response&&e.response.data?function(e){for(var t=0;t<(arguments.length<=1?0:arguments.length-1);t++){var a=t+1<1||arguments.length<=t+1?void 0:arguments[t+1];if(Array.isArray(a))return a;if("string"===typeof a)return[a]}return[e]}("An error occurred",e.response.data,e.response.data.errors,e.response.data.error):[e.message||"An error occurred"]}var he=a(39),Ee=a.n(he),ve=function(){return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:Ee.a.logo},r.a.createElement("div",{className:Ee.a.blob}),r.a.createElement("div",{className:Ee.a.blob})),r.a.createElement("svg",{className:Ee.a.svgFilter,xmlns:"http://www.w3.org/2000/svg",version:"1.1"},r.a.createElement("defs",null,r.a.createElement("filter",{id:"goo"},r.a.createElement("feGaussianBlur",{in:"SourceGraphic",stdDeviation:"10",result:"blur"}),r.a.createElement("feColorMatrix",{in:"blur",mode:"matrix",values:"1 0 0 0 0  0 1 0 0 0  0 0 1 0 0  0 0 0 18 -7",result:"goo"}),r.a.createElement("feBlend",{in:"SourceGraphic",in2:"goo"})))))},be=a(110),ye=a.n(be),_e=function(){var e=h().dispatch,t=Object(D.a)({username:"",loading:!1}),a=Object(i.a)(t,2),n=a[0],o=a[1];return r.a.createElement(N.a,{className:S()(ye.a.login,"mt-4")},r.a.createElement(ve,null),r.a.createElement(q.a,{noValidate:!0,onSubmit:function(t){if(t.preventDefault(),!n.loading){o((function(e){e.loading=!0}));var a={username:n.username};fe("/auth","POST",a).then((function(t){if(!t||!t.user.user_id)return console.warn("Invalid user object"),void e({type:"login",payload:null});e({type:"login",payload:t})})).catch((function(t){console.log("login fail reason",t),e({type:"error",payload:t.errors.join(", ")}),o((function(e){e.loading=!1}))}))}}},r.a.createElement(q.a.Group,{controlId:"loginForm.username"},r.a.createElement(q.a.Control,{as:"input",type:"text",placeholder:"What's your name?",disabled:n.loading,autoFocus:!0,onChange:function(e){var t=e.currentTarget.value;o((function(e){e.username=t}))},value:n.username}))))},ke=function(){var e=E(),t=e.state,a=e.dispatch;return t.auth.checked||fe("/auth","GET").then((function(e){if(!e||!e.user.uuid)return console.warn("Invalid user object"),void a({type:"login",payload:null});a({type:"login",payload:e})})).catch((function(e){console.log("Login check failed",e),a({type:"error",payload:e.errors.join(", ")}),a({type:"login",payload:null})})),r.a.createElement(r.a.Fragment,null,r.a.createElement(se,null),r.a.createElement(C.d,null,r.a.createElement(ne,{path:"/login",component:_e}),r.a.createElement(ae,{path:"/",component:Z})))};a(179);!function(){var e=w.b,t=w.a;x.b.add(j.f,j.h,j.d,j.g,j.e,j.b,j.c,j.o,j.n,j.m,j.l,O.a,j.j,j.a,e,t,j.p,j.k,j.q,j.i)}();var xe=r.a.createElement(l.a,{basename:"/dotdot/"},r.a.createElement(u.a,{titleTemplate:"%s | dotdot"}),r.a.createElement(p,null,r.a.createElement(k,null,r.a.createElement(ke,null))));s.a.render(xe,document.getElementById("root"))},37:function(e,t,a){e.exports={message:"Message_message__2v30T",dots:"Message_dots__24igM",user:"Message_user__3HofW",op:"Message_op__3lLYM"}},39:function(e,t,a){e.exports={logo:"Logo_logo__30xDu",svgFilter:"Logo_svgFilter__1s9i7",blob:"Logo_blob__1iSwo","blob-first":"Logo_blob-first__3YKrD","blob-second":"Logo_blob-second__2r5Nx","blob-third":"Logo_blob-third__2F93D"}},63:function(e,t,a){e.exports={offline:"OfflineCheck_offline__2vKbm"}},96:function(e,t,a){e.exports={container:"Chat_container__22QAh"}},98:function(e,t,a){e.exports={messages:"Messages_messages__tCmp1"}},99:function(e,t,a){}},[[113,1,2]]]);
//# sourceMappingURL=main.5192e27c.chunk.js.map